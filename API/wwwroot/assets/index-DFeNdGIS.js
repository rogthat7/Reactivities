var Ue=Object.defineProperty;var Ne=(s,n,r)=>n in s?Ue(s,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[n]=r;var z=(s,n,r)=>Ne(s,typeof n!="symbol"?n+"":n,r);import{j as e,r as f}from"./react-BqlbiFCO.js";import{c as Te}from"./react-dom-Cern445X.js";/* empty css                        */import{y as G,L as $e}from"./react-toastify-D-siWEAI.js";import{u as de,a as k,b as H,c as We,Q as qe,d as Be,R as Me}from"./@tanstack-BN8_fwTp.js";import{N as ve,u as ue,L as D,a as V,S as He,O as Se,b as U,c as Ie,d as Qe,R as Oe}from"./react-router-wPBFcI1l.js";import{M as N,B as w,a as c,A as O,b as Ke,L as te,c as _e,d as B,P as De,e as Ge,f as Ve,C as Le,T as Ye,h as i,i as Ae,j as P,k as Y,l as xe,m as he,n as Q,D as E,o as Je,p as Ze,q as Xe,r as Pe,s as es,F as ss,t as ns,E as rs,G as y,u as me,v as ts,I as os,S as is,w as as,x as ls,y as cs,z as ds,H as pe,J as us,K as xs,N as hs,O as ms,Q as ps,R as gs,U as fs,V as js,W as Fe,X as be,Y as bs,Z as ys,_ as ws,$ as Cs,a0 as vs,a1 as Ss,a2 as Is,a3 as Ds,a4 as Ls,a5 as Z,a6 as oe,a7 as As,a8 as Ps,a9 as Fs}from"./@mui-BKdEY9HJ.js";import{O as ks,o as X,u as zs}from"./mobx-react-lite-C6WCOFY4.js";import{a as ge,r as ye}from"./mobx-DbDvNnHe.js";import{a as ke}from"./axios-D4YhIzwJ.js";import{D as Rs,L as Es,C as Us}from"./semantic-ui-react-DLq1Ezzk.js";import{z as A}from"./zod-DtV2F3aZ.js";import{f as le,S as Ns}from"./date-fns-C5bwsslz.js";import{u as Ts}from"./react-intersection-observer-C93msGHE.js";import{C as $s}from"./react-calendar-6W8joyWd.js";import{u as ee,b as J}from"./react-hook-form-CVIkFDiC.js";import{s as se}from"./@hookform-BMVMi0mJ.js";import{l as Ws,m as qs}from"./leaflet-C5JgwxMT.js";import{M as Bs,T as Ms,a as Hs,P as Qs}from"./react-leaflet-DyRUiscd.js";import{H as Os}from"./@microsoft-JXRn2a9-.js";import{u as Ks}from"./react-dropzone-ZxMDaiT9.js";import{l as _s}from"./react-cropper-qJMKhiyF.js";import"./cropperjs-uBa9Hmhf.js";import"./scheduler-Dfnz5CHD.js";import"./use-sync-external-store-B7erJfGP.js";import"./cookie--_YQFYBD.js";import"./@babel-BtohYyOd.js";import"./prop-types-mC33irJP.js";import"./@emotion-jCgWLgdJ.js";import"./hoist-non-react-statics-C-Qo8PK8.js";import"./stylis-YPZU7XtI.js";import"./react-transition-group-Bg_mJ7fz.js";import"./dom-helpers-D0mFdbeO.js";import"./@popperjs-FRdid3Df.js";import"./@semantic-ui-react-C6_ZCt8T.js";import"./exenv-BS7ugsZD.js";import"./react-is-CUHInjVl.js";import"./keyboard-key-DAXUE7ji.js";import"./clsx-CH7BE6MN.js";import"./lodash-es-v1V5igHK.js";import"./get-user-locale-D0SQUETx.js";import"./mem-Dh3nNrwd.js";import"./mimic-fn-kh_GziL3.js";import"./map-age-cleaner-BgSfbQ-z.js";import"./p-defer-BUV9kL4s.js";import"./@wojtekmaj-D8ifTmD7.js";import"./@react-leaflet-D06ysXfn.js";import"./file-selector-DRwu1XGd.js";import"./tslib-6vuVcGup.js";import"./attr-accept-UHzFmALq.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function r(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(t){if(t.ep)return;t.ep=!0;const a=r(t);fetch(t.href,a)}})();function _({children:s,to:n}){return e.jsx(N,{component:ve,to:n,sx:{textDecoration:"none",fontSize:"1.2rem",textTransform:"uppercase",fontWeight:"bold",color:"inherit","&.active":{backgroundColor:"#1e90ff",color:"#ff7f50"},"&:hover":{backgroundColor:"#1e90ff",color:"#1976d2"},border:"none",padding:"10px 20px",borderRadius:"5px",transition:"all 0.3s ease-in-out",cursor:"pointer"},children:s})}class Gs{constructor(){z(this,"count",0);z(this,"title","Counter Store");z(this,"increment",(n=1)=>{this.count+=n});z(this,"decrement",(n=1)=>{this.count-=n});ge(this)}}class Vs{constructor(){z(this,"isLoading",!1);ge(this)}isBusy(){this.isLoading=!0}isIdle(){this.isLoading=!1}}class Ys{constructor(){z(this,"filter","all");z(this,"startDate",new Date().toISOString());z(this,"setFilter",n=>{this.filter=n});z(this,"setStartDate",n=>{this.startDate=n.toISOString()});ge(this)}}const R={counterStore:new Gs,UIStore:new Vs,activityStore:new Ys},ze=f.createContext(R);function ne(){return f.useContext(ze)}const C=ke.create({baseURL:"/api",timeout:1e4,withCredentials:!0});C.interceptors.request.use(s=>(R.UIStore.isBusy(),s));C.interceptors.response.use(async s=>{switch(s.status){case 200:case 201:return R.UIStore.isIdle(),s;case 204:return R.UIStore.isIdle(),Promise.resolve({});default:return Promise.reject(s.data)}},async s=>{var o,t;const n=(o=s.response)==null?void 0:o.status,r=(t=s.response)==null?void 0:t.data;switch(n){case 401:{G.error("Unauthorised"),R.UIStore.isIdle();break}case 403:{G.error("Forbidden"),R.UIStore.isIdle();break}case 404:{ce.navigate("/not-found");break}case 400:case 422:if(r!=null&&r.errors){const a=[];for(const d in r.errors)r.errors[d]&&a.push(r.errors[d]);throw R.UIStore.isIdle(),a.flat()}else r&&G.error(r);R.UIStore.isIdle();break;case 500:{ce.navigate("/server-error",{state:{error:r}});break}default:G.error("An unexpected error occurred");break}return R.UIStore.isIdle(),Promise.reject(r)});const K=()=>{const s=de(),n=ue(),r=k({mutationFn:async p=>{await C.post("/login?useCookies=true",p)},onSuccess:async()=>{await s.invalidateQueries({queryKey:["user"]})}}),o=k({mutationFn:async()=>{await C.post("/account/logout")},onSuccess:()=>{s.removeQueries({queryKey:["user"]}),s.removeQueries({queryKey:["activities"]}),n("/")}}),t=k({mutationFn:async p=>{await C.post("/account/register",p)},onSuccess:()=>{G.success("Register successful - you can now login"),n("/login")}}),{data:a,isLoading:d}=H({queryKey:["user"],queryFn:async()=>(await C.get("/account/user-info")).data,enabled:!s.getQueryData(["user"])});return{loginUser:r,currentUser:a,logoutUser:o,loadingUserInfo:d,registerUser:t}};function Js(){const[s,n]=f.useState(null),r=!!s,o=p=>{n(p.currentTarget)},t=()=>{n(null)},{currentUser:a,logoutUser:d}=K();return e.jsxs(e.Fragment,{children:[e.jsx(w,{onClick:o,color:"inherit",size:"large",sx:{fontSize:"1.1rem"},children:e.jsxs(c,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(O,{src:a==null?void 0:a.imageUrl,alt:"Logged in User"}),a==null?void 0:a.displayName]})}),e.jsxs(Ke,{id:"basic-menu",anchorEl:s,open:r,onClose:t,slotProps:{list:"basic-button"},children:[e.jsxs(N,{component:D,to:"/createActivity",onClick:t,children:[e.jsx(te,{children:e.jsx(_e,{})}),e.jsx(B,{children:"Create Activity"})]}),e.jsxs(N,{component:D,to:`/profiles/${a==null?void 0:a.id}`,onClick:t,children:[e.jsx(te,{children:e.jsx(De,{})}),e.jsx(B,{children:"My Profile"})]}),e.jsx(Rs,{style:{margin:"0.5rem 0"}}),e.jsxs(N,{onClick:()=>{d.mutate(),t()},children:[e.jsx(te,{children:e.jsx(Ge,{})}),e.jsx(B,{children:"Logout"})]})]})]})}function Zs(){const{currentUser:s}=K(),{UIStore:n}=ne();return e.jsx(c,{sx:{display:"flex"},children:e.jsx(Ve,{position:"fixed",sx:{backgroundImage:"linear-gradient(135deg, #182a73 0%, #218aae 69%, #20a7ac 89%)"},children:e.jsx(Le,{maxWidth:"lg",sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsxs(Ye,{variant:"dense",sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsx(c,{sx:{display:"flex",alignItems:"center",gap:2},children:e.jsxs(N,{component:ve,to:"/",sx:{display:"flex",alignItems:"center",textTransform:"uppercase",fontSize:"1.2rem",fontWeight:"bold"},children:[e.jsx("img",{src:"/assets/logo.png",alt:"Logo",style:{width:"50px",height:"50px",marginRight:"1rem"}}),e.jsx(i,{variant:"h4",fontWeight:"bold",style:{color:"#fff",position:"relative"},children:"Reactivities"}),e.jsx(ks,{children:()=>n.isLoading?e.jsx(Ae,{size:20,thickness:7,sx:{color:"#fff",position:"absolute",top:"30%",left:"105%"},color:"secondary"}):null})]})}),e.jsxs(c,{sx:{display:"flex",gap:2},children:[e.jsx(_,{to:"/activities",children:e.jsx(i,{fontWeight:"bold",style:{color:"#fff"},children:"Activities"})}),e.jsx(_,{to:"/counter",children:e.jsx(i,{fontWeight:"bold",style:{color:"#fff"},children:"Counter"})}),e.jsx(_,{to:"/errors",children:e.jsx(i,{fontWeight:"bold",style:{color:"#fff"},children:"Errors"})})]}),e.jsx(c,{display:"flex",alignItems:"center",children:s?e.jsx(Js,{}):e.jsxs(e.Fragment,{children:[e.jsx(_,{to:"/login",children:e.jsx(i,{fontWeight:"bold",style:{color:"#fff"},children:"Login"})}),e.jsx(_,{to:"/register",children:e.jsx(i,{fontWeight:"bold",style:{color:"#fff"},children:"Register"})})]})})]})})})})}function Re(){return e.jsx(P,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",backgroundColor:"#f5f5f5",gap:6,backgroundImage:"linear-gradient(135deg, #182a73 0%, #218aae 69%, #20a7ac 89%)"},children:e.jsxs(c,{sx:{alignItems:"center",alignContent:"center",color:"#fff"},children:[e.jsx("img",{src:"/assets/logo.png",alt:"Logo",style:{width:"150px",height:"150px",marginBottom:"1rem"}}),e.jsx(i,{variant:"h1",fontWeight:"bold",style:{color:"#fff"},children:"Reactivities"}),e.jsx(i,{variant:"h3",fontWeight:"bold",children:"Welcome to Reactivities"}),e.jsx(w,{variant:"contained",color:"primary",sx:{marginTop:"1rem",backgroundColor:"#fff",color:"#182a73",fontWeight:"bold"},component:D,to:"/activities",children:"Take me to Activities"})]})})}function Xs(){const s=V();return e.jsxs(c,{sx:{display:"flex",flexDirection:"column",height:"100vh",bgcolor:"#f5f5f5"},children:[e.jsx(He,{}),s.pathname==="/"?e.jsx(c,{sx:{flexGrow:1,bgcolor:"#f5f5f5"},children:e.jsx(Re,{})}):e.jsxs(e.Fragment,{children:[e.jsx(Zs,{}),e.jsx(Le,{maxWidth:"xl",sx:{flexGrow:1,padding:"5rem",bgcolor:"#f5f5f5"},children:e.jsx(Se,{})})]})]})}function fe(s){return le(s,"dd MMM yyyy h:mm a")}function en(s){return Ns(s)+" ago"}const q=s=>A.string({required_error:`${s} is Required`}).min(3,{message:`${s} is requires minimum 3 characters`});function Ee({profile:s}){return e.jsx(D,{to:`/profiles/${s.id}`,style:{textDecoration:"none"},children:e.jsxs(Y,{elevation:2,sx:{borderRadius:3,p:3,boxShadow:3,textDecoration:"none",maxWidth:200},children:[e.jsx(xe,{component:"img",src:(s==null?void 0:s.imageUrl)||"/assets/user.png",alt:(s==null?void 0:s.displayName)+" image",sx:{width:"100%",zIndex:50}}),e.jsx(he,{sx:{display:"flex",flexDirection:"column",alignItems:"left",textAlign:"left",fullwidth:"100%",justifyContent:"space-between"},children:e.jsxs(c,{display:"flex",flexDirection:"column",gap:1,sx:{mb:1},children:[e.jsx(i,{variant:"h5",children:s==null?void 0:s.displayName}),s.bio&&e.jsx(i,{variant:"body2",sx:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",maxWidth:250},children:s.bio}),(s==null?void 0:s.isFollowing)&&e.jsx(Q,{label:"Following",color:"secondary",variant:"outlined",size:"small",sx:{fontSize:"0.8rem",borderRadius:2}})]})}),e.jsx(E,{sx:{mb:2}}),e.jsxs(c,{display:"flex",gap:2,sx:{alignItems:"center",justifyContent:"start"},children:[e.jsx(De,{}),e.jsxs(i,{children:[s==null?void 0:s.followersCount," Followers"]})]})]})})}function sn({profile:s}){const[n,r]=f.useState(null),o=d=>{r(d.currentTarget)},t=()=>{r(null)},a=!!n;return e.jsxs(e.Fragment,{children:[e.jsx(O,{src:s.imageUrl,alt:s.displayName+" image",component:D,to:`/profiles/${s.id}`,onMouseEnter:o,onMouseLeave:t,sx:{border:s.isFollowing?"2px solid orange":"none",borderColor:"secondary.main"}}),e.jsx(Je,{id:"mouse-over-popover",open:a,anchorEl:n,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},onClose:t,disableRestoreFocus:!0,sx:{cursor:"pointer",marginRight:1,pointerEvents:"none"},children:e.jsx(Ee,{profile:s})})]})}function nn({activity:s}){const n=s.isHost?"You are hosting":"You are going",r=s.isHost?"secondary":s.isGoing?"warning":"default";return e.jsxs(Y,{elevation:2,sx:{borderRadius:3,boxShadow:3,marginBottom:2},children:[e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{padding:1},children:[e.jsx(Ze,{avatar:e.jsx(O,{sx:{height:80,width:80},src:s.hostImageUrl,alt:"Host Image"}),title:s.title,subheader:e.jsxs(e.Fragment,{children:["Hosted By"," "," ",e.jsx(D,{to:`/profiles/${s.hostId}`,style:{textDecoration:"none",color:"text.primary"},children:s.hostDisplayName})]})}),e.jsxs(c,{display:"flex",flexDirection:"column",sx:{mr:2,gap:2,backgroundColor:r,borderRadius:1,padding:.5,color:"white",fontSize:"0.8rem",fontWeight:"bold"},children:[(s.isGoing||s.isHost)&&e.jsx(Q,{label:n,variant:"outlined",color:r,size:"small",sx:{fontSize:"0.8rem",borderRadius:2}}),s.isCancelled&&e.jsx(Q,{label:"Cancelled",color:"error",size:"small",sx:{fontSize:"0.8rem",borderRadius:2}})]})]}),e.jsx(E,{sx:{mb:3}}),e.jsxs(he,{sx:{padding:0},children:[e.jsxs(c,{display:"flex",alignItems:"center",sx:{mb:2,px:2},children:[e.jsxs(c,{display:"flex",alignItems:"center",gap:0,children:[e.jsx(Xe,{sx:{color:"text.primary",mr:1,display:"flex"}}),e.jsx(i,{variant:"body2",color:"text.primary",noWrap:!0,children:s.date?fe(s.date):"Date not available"})]}),e.jsx(Pe,{sx:{ml:3,mr:1}}),e.jsxs(i,{variant:"body2",children:[" ",s.venue]})]}),e.jsx(E,{}),e.jsx(c,{display:"flex",gap:2,sx:{backgroundColor:"grey.200",py:3,pl:3},children:s.attendees.map(o=>e.jsx(sn,{profile:o},o.id))}),e.jsx(es,{sx:{display:"flex",ml:1},children:e.jsx(i,{variant:"body2",color:"text.secondary",children:s.description})}),e.jsx(c,{display:"flex",justifyContent:"flex-end",sx:{padding:1},children:e.jsx(w,{component:D,to:`/activities/${s.id}`,variant:"contained",color:"primary",size:"medium",sx:{textTransform:"none",justifySelf:"self-end",borderRadius:3},children:e.jsx(i,{style:{color:"white"},children:"View"})})})]})]})}const re=s=>{const n=de(),{currentUser:r}=K(),o=V(),{activityStore:{filter:t,startDate:a}}=ne(),{data:d,isLoading:p,isFetchingNextPage:h,fetchNextPage:u,hasNextPage:S}=We({queryKey:["activities",t,a],queryFn:async({pageParam:m=null})=>(await C.get("/activities",{params:{cursor:m,pageSize:3,filter:t,startDate:a}})).data,keepPreviousData:!0,enabled:!s&&o.pathname==="/activities"&&!!r,select:m=>({...m,pages:m.pages.map(v=>({...v,items:v.items.map(l=>{const g=l.attendees.find(b=>b.id===l.hostId);return{...l,isHost:(r==null?void 0:r.id)===l.hostId,isGoing:l.attendees.some(b=>b.id===(r==null?void 0:r.id)),hostImageUrl:(g==null?void 0:g.imageUrl)||""}})}))})}),{data:j,isLoading:I}=H({queryKey:["activities",s],queryFn:async()=>(await C.get(`/activities/${s}`)).data,enabled:!!s&&!!r,select:m=>{const v=m.attendees.find(l=>l.id===m.hostId);return{...m,isHost:(r==null?void 0:r.id)===m.hostId,isGoing:m.attendees.some(l=>l.id===(r==null?void 0:r.id)),hostImageUrl:v==null?void 0:v.imageUrl}},onError:m=>{console.error("Error fetching activity:",m)}}),L=k({mutationFn:async m=>(await C.post("/activities",m)).data,onSuccess:async()=>{await n.invalidateQueries({queryKey:["activities"]})},onError:m=>{console.error("Error creating activity:",m)}}),x=k({mutationFn:async m=>(await C.put(`/activities/${m.id}`,m)).data,onSuccess:async()=>{await n.invalidateQueries({queryKey:["activities"]})}}),F=k({mutationFn:async m=>(await C.delete(`/activities/${m}`)).data,onSuccess:async()=>{await n.invalidateQueries({queryKey:["activities"]})}}),$=k({mutationFn:async m=>(await C.post(`/activities/${m}/attend`,{})).data,onMutate:async m=>{await n.cancelQueries({queryKey:["activities",m]});const v=n.getQueryData(["activities",m]);return n.setQueryData(["activities",m],l=>{if(!l||!r)return l;const g=r.id===l.hostId,b=l.attendees.some(W=>W.id===r.id);return{...l,isCancelled:g?!l.isCancelled:l.isCancelled,attendees:b?g?l.attendees:l.attendees.filter(W=>W.id!==r.id):[...l.attendees,{id:r.id,displayName:r.displayName,imageUrl:r.imageUrl,username:r.email||"",following:!1,followersCount:0,followingCount:0}]}}),{previousActivity:v}},onError:(m,v,l)=>{console.error("Error updating attendance:",m),l!=null&&l.previousActivity&&n.setQueryData(["activities",v],l==null?void 0:l.previousActivity)}});return{activitiesGroup:d,createActivity:L,updateActivity:x,deleteActivity:F,isLoading:p,isLoadingActivity:I,activity:j,updateAttendance:$,isFetchingNextPage:h,fetchNextPage:u,hasNextPage:S}},rn=X(function(){const{activitiesGroup:n,isLoading:r,hasNextPage:o,fetchNextPage:t}=re(),{ref:a,inView:d}=Ts({threshold:.5});return f.useEffect(()=>{d&&o&&t()},[d,o,t]),n?r?e.jsx(i,{children:"Loading..."}):e.jsx(c,{children:n.pages.map((p,h)=>e.jsx(c,{ref:h===n.pages.length-1?a:null,display:"flex",flexDirection:"column",gap:3,children:p==null?void 0:p.items.map(u=>e.jsx(nn,{activity:{...u,hostImageUrl:u.hostImageUrl??""}},u.id))},h))}):e.jsx(i,{children:"No activities found."})}),tn=X(function(){const{activityStore:{setFilter:n,setStartDate:r,filter:o,startDate:t}}=ne();return e.jsxs(c,{sx:{position:"sticky",top:"7rem",alignSelf:"flex-start",display:"flex",flexDirection:"column",gap:3,borderRadius:3},children:[e.jsx(P,{sx:{padding:3,borderRadius:3,backgroundColor:"#f5f5f5"},children:e.jsxs(c,{sx:{width:"100%"},children:[e.jsxs(i,{variant:"h5",sx:{fontWeight:"bold",mb:1,alignItems:"center",display:"flex",gap:1,color:"primary.main"},children:[e.jsx(ss,{sx:{color:"#333",mr:1}}),"Filters"]}),e.jsxs(ns,{children:[e.jsx(N,{selected:o==="all",onClick:()=>n("all"),children:e.jsx(B,{primary:"All Events"})}),e.jsx(N,{selected:o==="isGoing",onClick:()=>n("isGoing"),children:e.jsx(B,{primary:"I'm Going"})}),e.jsx(N,{selected:o==="isHost",onClick:()=>n("isHost"),children:e.jsx(B,{primary:"I'm Hosting"})})]})]})}),e.jsxs(c,{component:P,sx:{padding:3,borderRadius:3,width:"100%"},children:[e.jsxs(i,{variant:"h5",sx:{fontWeight:"bold",mb:1,alignItems:"center",display:"flex",gap:1,color:"primary.main"},children:[e.jsx(rs,{sx:{color:"#333",mr:1}}),"Select Date"]}),e.jsx($s,{value:t||new Date,onChange:a=>r(a)})]})]})});function on(){return e.jsxs(y,{container:!0,spacing:2,sx:{marginTop:"2rem"},children:[e.jsx(y,{size:8,children:e.jsx(rn,{})}),e.jsx(y,{size:4,children:e.jsx(tn,{})})]})}function T(s){var o;const{field:n,fieldState:r}=ee({...s});return e.jsx(me,{...s,...n,value:n.value||"",fullWidth:!0,onChange:t=>{n.onChange(t.target.value),s.onChange&&s.onChange(t)},variant:"outlined",error:!!r.error,helperText:(o=r.error)==null?void 0:o.message})}function an(s){var o;const{field:n,fieldState:r}=ee({...s});return e.jsxs(ts,{fullWidth:!0,error:!!r.error,children:[e.jsx(os,{children:s.label}),e.jsx(is,{value:n.value||"",label:s.label,onChange:n.onChange,children:s.items.map(t=>e.jsx(N,{value:t.value,children:t.text},t.value))}),e.jsx(as,{children:(o=r.error)==null?void 0:o.message})]})}const ln=[{text:"Drinks",value:"drinks"},{text:"Culture",value:"culture"},{text:"Film",value:"film"},{text:"Food",value:"food"},{text:"Music",value:"music"},{text:"Travel",value:"travel"}];function cn(s){var o;const{field:n,fieldState:r}=ee({...s});return e.jsx(ls,{...s,value:n.value?new Date(n.value):null,onChange:t=>{n.onChange(new Date(t))},sx:{width:"100%"},slotProps:{textField:{onBlur:n.onBlur,error:!!r.error,helperText:(o=r.error)==null?void 0:o.message}}})}function dn(s){var L;const{field:n,fieldState:r}=ee({...s}),[o,t]=f.useState(!1),[a,d]=f.useState([]),[p,h]=f.useState(n.value||"");f.useEffect(()=>{n.value&&typeof n.value=="object"?h(n.value.venue||""):h(n.value||"")},[n.value]);const u="https://api.locationiq.com/v1/autocomplete?key=e24adf97ff7897&limit=5&dedupe=1&",S=f.useMemo(()=>cs(async x=>{if(!x||x.length<3){d([]);return}t(!0);try{const F=await ke.get(`${u}q=${x}`);d(F.data)}catch(F){console.log(F),t(!1)}},500),[u]),j=async x=>{n.onChange(x),await S(x)},I=x=>{var l,g,b,W,je;const F=((l=x.address)==null?void 0:l.city)||((g=x.address)==null?void 0:g.town)||((b=x.address)==null?void 0:b.village)||((W=x.address)==null?void 0:W.county)||((je=x.address)==null?void 0:je.state),$=x.display_name,m=x.lat,v=x.lon;h($),n.onChange({city:F,venue:$,latitude:m,longitude:v}),d([]),t(!1)};return e.jsxs(c,{children:[e.jsx(me,{...s,value:p,label:"Location",variant:"outlined",fullWidth:!0,onChange:async x=>{j(x.target.value)},helperText:(L=r.error)==null?void 0:L.message,error:!!r.error}),o&&e.jsx(i,{children:"Loading..."}),a.length>0&&e.jsx(Es,{sx:{border:1},children:a.map(x=>e.jsx(ds,{divider:!0,onClick:()=>I(x),children:x.display_name},x.place_id))})]})}const un=A.object({title:q("Title"),date:A.coerce.date({message:"Date is Required"}),description:q("Description"),category:q("Category"),location:A.object({city:A.string().optional(),venue:q("Venue"),latitude:A.coerce.number(),longitude:A.coerce.number()})});function we(){const{id:s}=U(),{updateActivity:n,createActivity:r,activity:o,isLoadingActivity:t}=re(s),a=ue(),{reset:d,handleSubmit:p,control:h}=J({resolver:se(un),mode:"onTouched"});f.useEffect(()=>{o&&d({...o,date:o.date||void 0,location:{city:o.city,venue:o.venue,latitude:o.latitude,longitude:o.longitude}})},[o,d]);const u=S=>{const{location:j,...I}=S,L={...I,...j};try{o?n.mutate({...o,...L},{onSuccess:()=>a(`/activities/${o.id}`)}):r.mutate({...L,location:{...j,city:j.city||""}},{onSuccess:x=>{a(`/activities/${x}`)}})}catch(x){console.log(x)}};return e.jsxs(P,{elevation:3,sx:{borderRadius:3,padding:2,margin:1},children:[e.jsx(i,{variant:"h5",gutterBottom:!0,color:"primary",children:o!=null&&o.id?"Edit Activity":"Create Activity"}),e.jsxs(c,{component:"form",display:"flex",gap:2,flexDirection:"column",autoComplete:"off",onSubmit:p(u),children:[e.jsx(T,{label:"Title",control:h,name:"title"}),e.jsx(T,{label:"Description",name:"description",control:h,multiline:!0,rows:3}),e.jsxs(c,{display:"flex",gap:3,children:[e.jsx(an,{items:ln,label:"Category",name:"category",control:h}),e.jsx(cn,{label:"Date",control:h,name:"date"})]}),e.jsx(dn,{control:h,label:"Enter the location",name:"location"}),e.jsx(c,{sx:{display:"flex",justifyContent:"right",pb:2},justifyContent:"space-between",marginTop:2,children:e.jsxs(pe,{sx:{display:"flex",gap:2,borderRadius:3},children:[e.jsx(w,{onClick:()=>a(-1),variant:"contained",color:"inherit",children:"Cancel"}),e.jsx(w,{variant:"contained",color:"success",type:"submit",disabled:n.isLoading||r.isLoading,children:"Submit"})]})})]})]})}const ie=us(w)(({theme:s})=>({"&.Mui-disabled":{backgroundColor:s.palette.grey[600],color:s.palette.common.white}}));function xn({activity:s}){const{updateAttendance:n}=re(s==null?void 0:s.id);return e.jsxs(Y,{sx:{position:"relative",mb:2,backgroundColor:"transparent",overflow:"hidden"},children:[(s==null?void 0:s.isCancelled)&&e.jsx(Q,{sx:{position:"absolute",left:40,top:20,zIndex:1e3,borderRadius:1},color:"error",label:"Cancelled"}),e.jsx(xe,{component:"img",height:"300",image:`/assets/categoryImages/${s==null?void 0:s.category}.jpg`,alt:`${s==null?void 0:s.category} image`}),e.jsxs(c,{sx:{position:"absolute",bottom:0,width:"100%",color:"white",padding:2,display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"flex-end",background:"linear-gradient(to top, rgba(0, 0, 0, 1.0), transparent)",boxSizing:"border-box"},children:[e.jsxs(c,{children:[e.jsx(i,{variant:"h4",sx:{fontWeight:"bold"},children:s==null?void 0:s.title}),e.jsx(i,{variant:"subtitle1",children:s!=null&&s.date?fe(s.date):"Date not available"}),e.jsxs(i,{variant:"subtitle2",children:["Hosted by ",e.jsx(D,{to:`/profiles/${s==null?void 0:s.hostId}`,style:{color:"white",fontWeight:"bold"},children:s==null?void 0:s.hostDisplayName})]})]}),e.jsx(c,{sx:{display:"flex",gap:2},children:s!=null&&s.isHost?e.jsxs(e.Fragment,{children:[e.jsx(ie,{variant:"contained",color:s!=null&&s.isCancelled?"success":"error",onClick:()=>(s==null?void 0:s.id)&&n.mutate(s.id),disabled:n.isLoading,children:e.jsx(i,{children:s!=null&&s.isCancelled?"Re-activate Activity":"Cancel Activity"})}),e.jsx(ie,{variant:"contained",color:"primary",component:D,to:`/manage/${s==null?void 0:s.id}`,disabled:s==null?void 0:s.isCancelled,children:e.jsx(i,{color:"White",children:"Manage Event"})})]}):e.jsx(ie,{variant:"contained",color:s!=null&&s.isGoing?"primary":"info",onClick:()=>(s==null?void 0:s.id)&&n.mutate(s.id),disabled:n.isLoading||(s==null?void 0:s.isCancelled),children:s!=null&&s.isGoing?"Cancel Attendance":"Join Activity"})})]})]})}function hn({position:s,venue:n}){return e.jsxs(Bs,{center:s,zoom:13,scrollWheelZoom:!1,style:{height:"100%"},children:[e.jsx(Ms,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(Hs,{position:s,icon:new Ws.Icon({iconUrl:qs,iconSize:[25,41],iconAnchor:[12,41]}),children:e.jsx(Qs,{children:n})})]})}function mn({activity:s}){const[n,r]=f.useState(!1);return e.jsxs(P,{sx:{mb:2},children:[e.jsxs(y,{container:!0,alignItems:"center",pl:2,py:1,children:[e.jsx(y,{size:1,children:e.jsx(xs,{color:"info",fontSize:"large"})}),e.jsx(y,{size:11,children:e.jsx(i,{children:s==null?void 0:s.description})})]}),e.jsx(E,{}),e.jsxs(y,{container:!0,alignItems:"center",pl:2,py:1,children:[e.jsx(y,{size:1,children:e.jsx(hs,{color:"info",fontSize:"large"})}),e.jsx(y,{size:11,children:e.jsx(i,{children:s!=null&&s.date?fe(s.date):"Date not available"})})]}),e.jsx(E,{}),e.jsxs(y,{container:!0,alignItems:"center",pl:2,py:1,children:[e.jsx(y,{size:1,children:e.jsx(Pe,{color:"info",fontSize:"large"})}),e.jsxs(y,{size:11,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(i,{children:[s==null?void 0:s.venue,", ",s==null?void 0:s.city]}),e.jsx(w,{sx:{whiteSpace:"nowrap",mx:2},onClick:()=>{r(!n)},children:n?"Hide map":"Show map"})]})]}),n&&e.jsx(c,{sx:{height:300,zIndex:1e3,display:"block"},children:e.jsx(hn,{position:[(s==null?void 0:s.latitude)??0,(s==null?void 0:s.longitude)??0],venue:(s==null?void 0:s.venue)||"Unknown venue"})})]})}const pn=s=>{const n=f.useRef(!1),r=zs(()=>({comments:[],hubConnection:null,setHubConnection(o){o&&(this.hubConnection=new Os().withUrl(`/comments?activityId=${o}`,{withCredentials:!0}).withAutomaticReconnect().build(),this.hubConnection.start().catch(t=>console.error("Error Establishing Hub Connection: ",t)),this.hubConnection.on("LoadComments",t=>{ye(()=>{this.comments=t})}),this.hubConnection.on("ReceiveComment",t=>{ye(()=>{this.comments.unshift(t)})}))},stopHubConnection(){this.hubConnection&&this.hubConnection.state==="Connected"&&this.hubConnection.stop().catch(o=>console.error("Error Stopping Hub Connection: ",o))}}));return f.useEffect(()=>(s&&!n.current&&(n.current=!0,r.setHubConnection(s)),()=>{r.stopHubConnection(),r.comments=[]}),[s]),{commentStore:r}},gn=X(function(){const{id:n}=U(),{commentStore:r}=pn(n),{register:o,handleSubmit:t,reset:a,formState:{isSubmitting:d}}=J(),p=async u=>{var S;try{await((S=r.hubConnection)==null?void 0:S.invoke("SendComment",{activityId:n,body:u.body})),a()}catch(j){console.log(j)}},h=u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),t(p)())};return e.jsxs(e.Fragment,{children:[e.jsx(c,{sx:{textAlign:"center",bgcolor:"primary.main",color:"white",padding:2},children:e.jsx(i,{variant:"h6",children:"Chat about this event"})}),e.jsx(Y,{children:e.jsxs(he,{children:[e.jsx("div",{children:e.jsx("form",{children:e.jsx(me,{...o("body",{required:!0}),onKeyDown:h,variant:"outlined",fullWidth:!0,multiline:!0,rows:2,placeholder:"Enter your comment (Enter to submit, SHIFT + Enter for new line)",slotProps:{input:{endAdornment:d?e.jsx(Ae,{size:24}):null}}})})}),e.jsx(c,{sx:{height:400,overflowY:"auto",mt:1},children:r.comments.map(u=>e.jsxs(c,{sx:{display:"flex",my:2},children:[e.jsx(O,{src:u.imageUrl,alt:"user image",sx:{mr:2}}),e.jsxs(c,{display:"flex",flexDirection:"column",children:[e.jsxs(c,{display:"flex",alignItems:"center",gap:3,children:[e.jsx(i,{component:D,to:`/profiles/${u.userId}`,variant:"subtitle1",sx:{fontWeight:"bold",textDecoration:"none"},children:u.displayName}),e.jsx(i,{variant:"body2",color:"textSecondary",children:en(u.createdAt)})]}),e.jsx(i,{sx:{whiteSpace:"pre-wrap"},children:u.body})]})]},u.id))})]})})]})});function fn({activity:s}){return e.jsxs(e.Fragment,{children:[e.jsx(P,{sx:{textAlign:"center",border:"none",backgroundColor:"primary.main",color:"white",p:2},children:e.jsxs(i,{variant:"h6",children:[s==null?void 0:s.attendees.length," ",(s==null?void 0:s.attendees.length)===1?"Person":"People"," Going"]})}),e.jsx(P,{sx:{padding:2},children:s==null?void 0:s.attendees.map(n=>e.jsxs(y,{container:!0,alignItems:"center",children:[e.jsx(y,{size:8,children:e.jsx(ms,{sx:{display:"flex",flexDirection:"column"},children:e.jsxs(ps,{component:D,to:`/profiles/${n.id}`,children:[e.jsx(gs,{children:e.jsx(O,{variant:"rounded",sx:{width:75,height:75,mr:3},alt:n.displayName,src:n.imageUrl})}),e.jsxs(B,{children:[e.jsx(i,{variant:"h6",children:n.displayName}),(n==null?void 0:n.isFollowing)&&e.jsx(i,{variant:"body2",color:"orange",children:"Following"})]})]})})}),e.jsx(y,{size:4,sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1},children:(s==null?void 0:s.hostId)===n.id&&e.jsx(Q,{label:"Host",color:"warning",variant:"filled",sx:{borderRadius:2}})})]},n.id))})]})}function jn(){const{id:s}=U(),{activity:n,isLoadingActivity:r}=re(s);return r?e.jsx(i,{variant:"h5",color:"primary",children:"Loading..."}):n?e.jsxs(y,{container:!0,spacing:3,children:[e.jsxs(y,{size:8,children:[e.jsx(xn,{activity:n}),e.jsx(mn,{activity:n}),e.jsx(gn,{})]}),e.jsx(y,{size:4,children:e.jsx(fn,{activity:n})})]}):e.jsx(i,{variant:"h5",color:"error",children:"Activity not found"})}const bn=X(function(){const{counterStore:n}=ne(),{count:r,title:o}=n;return console.log("Counter component rendered",r,o),e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"h4",color:"primary",gutterBottom:!0,children:o}),e.jsxs(i,{variant:"h6",color:"secondary",gutterBottom:!0,children:["Count: ",n.count]}),e.jsxs(pe,{variant:"contained",color:"primary","aria-label":"outlined primary button group",sx:{mt:2,p:2,gap:2},children:[e.jsx(w,{color:"primary",variant:"contained",onClick:()=>n.increment(1),children:"Increment"}),e.jsx(w,{color:"secondary",variant:"contained",onClick:()=>n.decrement(1),children:"Decrement"})]})]})});function yn(){const[s,n]=f.useState([]),{mutate:r}=k({mutationFn:async({path:t,method:a="get"})=>{a==="post"?await C.post(t,{}):await C.get(t)},onError:t=>{Array.isArray(t)?n(t):n([])}}),o=(t,a="get")=>{r({path:t,method:a})};return e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"h4",children:"Test errors component"}),e.jsxs(pe,{variant:"contained",sx:{mt:4},children:[e.jsx(w,{onClick:()=>o("buggy/not-found"),children:"Not found"}),e.jsx(w,{onClick:()=>o("buggy/bad-request"),children:"Bad request"}),e.jsx(w,{onClick:()=>o("activities","post"),children:"Validation error"}),e.jsx(w,{onClick:()=>o("buggy/server-error"),children:"Server error"}),e.jsx(w,{onClick:()=>o("buggy/unauthorised"),children:"Unauthorised"})]}),s.map((t,a)=>e.jsx(fs,{color:"error",severity:"error",children:t},a))]})}function wn(){return e.jsxs(P,{elevation:3,sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:400},children:[e.jsx(js,{sx:{fontSize:100,color:"primary"}}),e.jsx(i,{variant:"h3",sx:{mt:2},children:"We couldn't find what you are looking for."}),e.jsx(w,{variant:"contained",sx:{mt:2},component:D,to:"/activities",children:e.jsx(i,{color:"white",children:"Go back to activities"})})]})}function Cn(){const{state:s}=V();return e.jsx(P,{children:s!=null&&s.error?e.jsxs(e.Fragment,{children:[e.jsx(i,{color:"error",gutterBottom:!0,variant:"h3",sx:{px:4,pt:2},children:s.error.message||"Internal Server error"}),e.jsx(E,{}),e.jsx(i,{gutterBottom:!0,variant:"body1",sx:{px:4},children:s.error.detail||"Internal Server error"})]}):e.jsx(i,{gutterBottom:!0,variant:"h3",sx:{px:4,pt:2},children:"Server error"})})}const vn=A.object({email:A.string().email(),password:A.string().min(6)});function Sn(){const{loginUser:s}=K(),n=ue(),r=V(),{control:o,handleSubmit:t,formState:{isValid:a,isSubmitting:d}}=J({mode:"onTouched",resolver:se(vn)}),p=async h=>{await s.mutateAsync(h,{onSuccess:()=>{var u;n(((u=r.state)==null?void 0:u.from)||"/activities")}})};return e.jsxs(P,{component:"form",onSubmit:t(p),sx:{display:"flex",flexDirection:"column",p:3,gap:3,maxWidth:"md",mx:"auto",borderRadius:3},children:[e.jsxs(c,{display:"flex",alignItems:"center",justifyContent:"center",gap:3,color:"secondary.main",children:[e.jsx(Fe,{fontSize:"large"}),e.jsx(i,{variant:"h4",children:"Sign in "})]}),e.jsx(T,{label:"Email",control:o,name:"email"}),e.jsx(T,{type:"password",label:"Password",control:o,name:"password"}),e.jsx(w,{type:"submit",disabled:!a||d,variant:"contained",size:"large",children:"Login"}),e.jsxs(i,{sx:{textAlign:"center"},children:["Don't have an account?",e.jsx(i,{component:D,to:"/register",color:"primary",sx:{ml:2},children:"Sign up"})]})]})}function In(){const{currentUser:s,loadingUserInfo:n}=K(),r=V();return n?e.jsx(i,{children:"Loading..."}):s?e.jsx(Se,{}):e.jsx(Ie,{to:"/login",state:{from:r}})}const Dn=A.object({email:A.string().email(),displayName:q("displayName"),password:q("password")});function Ln(){const{registerUser:s}=K(),{control:n,handleSubmit:r,setError:o,formState:{isValid:t,isSubmitting:a}}=J({mode:"onTouched",resolver:se(Dn)}),d=async p=>{await s.mutateAsync(p,{onError(h){Array.isArray(h)&&h.forEach(u=>{u.includes("Email")?o("email",{message:u}):u.includes("Password")&&o("password",{message:u})})}})};return e.jsxs(P,{component:"form",onSubmit:r(d),sx:{display:"flex",flexDirection:"column",p:3,gap:3,maxWidth:"md",mx:"auto",borderRadius:3},children:[e.jsxs(c,{display:"flex",alignItems:"center",justifyContent:"center",gap:3,color:"secondary.main",children:[e.jsx(Fe,{fontSize:"large"}),e.jsx(i,{variant:"h4",children:"Register"})]}),e.jsx(T,{label:"Email",control:n,name:"email"}),e.jsx(T,{label:"Display Name",control:n,name:"displayName"}),e.jsx(T,{type:"password",label:"Password",control:n,name:"password"}),e.jsx(w,{type:"submit",disabled:!t||a,variant:"contained",size:"large",children:"Register"}),e.jsxs(i,{sx:{textAlign:"center"},children:["Already have an account?",e.jsx(i,{component:D,to:"/login",color:"primary",sx:{ml:2},children:"Sign in"})]})]})}const M=(s,n)=>{const[r,o]=f.useState(null),t=de(),{data:a,isLoading:d}=H({queryKey:["profile",s],queryFn:async()=>(await C.get(`/profiles/${s}`)).data,enabled:!!s&&!n}),{data:p,isLoading:h}=H({queryKey:["photos",s],queryFn:async()=>(await C.get(`/profiles/${s}/photos`)).data,enabled:!!s}),u=k({mutationFn:async()=>{await C.post(`/profiles/${s}/follow`)},onSuccess:async()=>{t.setQueryData(["profile",s],l=>(t.invalidateQueries({queryKey:["followings",s,"followers"]}),!l||l.followersCount===void 0?l:{...l,isFollowing:!l.isFollowing,followersCount:l.isFollowing?l.followersCount-1:l.followersCount+1}))}}),S=f.useMemo(()=>{var l;return s===((l=t.getQueryData(["user"]))==null?void 0:l.id)},[s,t]),{data:j,isLoading:I}=H({queryKey:["followings",s,n],queryFn:async()=>(await C.get(`/profiles/${s}/follow-list/?predicate=${n}`)).data,enabled:!!s&&!!n}),{data:L,isLoading:x}=H({queryKey:["user-activities",s,r],queryFn:async()=>(await C.get(`/profiles/${s}/activities`,{params:{filter:r}})).data,enabled:!!s&&!!r}),F=k({mutationFn:async l=>{const g=new FormData;return g.append("file",l),(await C.post("/profiles/add-photo",g,{headers:{"Content-Type":"multipart/form-data"}})).data},onSuccess:async l=>{await t.invalidateQueries({queryKey:["photos",s]}),t.setQueryData(["user"],g=>g&&{...g,imageUrl:g.imageUrl??l.url}),t.setQueryData(["profile",s],g=>g&&{...g,imageUrl:g.imageUrl??l.url})}}),$=k({mutationFn:async l=>{await C.put(`/profiles/${l.id}/set-main-photo`)},onSuccess:async(l,g)=>{await t.invalidateQueries({queryKey:["photos",g.id]}),t.setQueryData(["user"],b=>b&&{...b,imageUrl:g.url}),t.setQueryData(["profile",s],b=>b&&{...b,imageUrl:g.url})}}),m=k({mutationFn:async l=>{await C.delete(`/profiles/${l}/photos`)},onSuccess:async(l,g)=>{t.setQueryData(["photos",s],b=>b==null?void 0:b.filter(W=>W.id!==g))}}),v=k({mutationFn:async l=>{await C.put(`/profiles/${l.id}/edit-profile`,l)},onSuccess:async(l,g)=>{t.setQueryData(["profile",s],b=>b&&{...b,displayName:g.displayName,bio:g.bio}),t.setQueryData(["user"],b=>b&&{...b,displayName:g.displayName})}});return{profile:a,isLoadingProfile:d,photos:p,isLoadingPhoto:h,isCurrentUser:S,uploadPhoto:F,setMainPhoto:$,deletePhoto:m,editProfile:v,updateFollowing:u,followings:j,loadingFollowings:I,userActivities:L,isLoadingUserActivities:x,setFilter:o}};function An(){const{id:s}=U(),{profile:n,isCurrentUser:r,updateFollowing:o}=M(s);return n?e.jsx(P,{elevation:4,sx:{padding:2,borderRadius:3},children:e.jsxs(y,{container:!0,alignItems:"center",children:[e.jsx(y,{size:8,children:e.jsxs(be,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(O,{sx:{width:150,height:150},src:n.imageUrl||"/assets/user.png",alt:n.displayName+" image"}),e.jsxs(c,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(i,{variant:"h4",fontWeight:700,children:n.displayName}),n.isFollowing&&e.jsx(Q,{variant:"outlined",label:"Following",color:"secondary",sx:{borderRadius:1}})]})]})}),e.jsx(y,{size:4,children:e.jsxs(be,{spacing:2,alignItems:"center",children:[e.jsxs(c,{display:"flex",flexDirection:"row",gap:2,width:"100%",justifyContent:"space-around",children:[e.jsxs(c,{textAlign:"center",children:[e.jsx(i,{variant:"h6",fontWeight:700,children:"Followers"}),e.jsx(i,{variant:"h3",fontWeight:700,children:n.followersCount})]}),e.jsxs(c,{textAlign:"center",children:[e.jsx(i,{variant:"h6",fontWeight:700,children:"Following"}),e.jsx(i,{variant:"h3",fontWeight:700,children:n.followingsCount})]})]}),!r&&e.jsxs(e.Fragment,{children:[e.jsx(E,{sx:{width:"100%"}}),e.jsx(w,{onClick:()=>o.mutate(),variant:"outlined",color:n.isFollowing?"error":"primary",fullWidth:!0,children:n.isFollowing?"Unfollow":"Follow"})]})]})})]})}):e.jsx(i,{children:"Profile not found"})}function Pn({uploadPhoto:s,loading:n}){var S;const[r,o]=f.useState([]),t=f.useRef(null);f.useEffect(()=>{if(r.length>0)return()=>{r.forEach(j=>URL.revokeObjectURL(j.preview))}},[r]);const a=f.useCallback(j=>{o(j.map(I=>Object.assign(I,{preview:URL.createObjectURL(I)})))},[]),d=f.useCallback(()=>{var I;const j=(I=t.current)==null?void 0:I.cropper;j&&j.getCroppedCanvas().toBlob(L=>{L&&s(L)},"image/jpeg",.8)},[s]),{getRootProps:p,getInputProps:h,isDragActive:u}=Ks({onDrop:a});return e.jsxs(y,{container:!0,spacing:5,children:[e.jsxs(y,{size:4,children:[e.jsx(i,{variant:"overline",color:"secondary",children:"Step 1 - Add Photo"}),e.jsxs(c,{...p(),sx:{border:"2px dashed grey",borderRadius:2,padding:2,textAlign:"center",cursor:"pointer",height:"280px",backgroundColor:u?"lightblue":"white","&:hover":{backgroundColor:u?"lightblue":"#f0f0f0"}},children:[e.jsx("input",{...h()}),e.jsx(bs,{fontSize:"large",color:"action"}),e.jsxs(i,{variant:"h5",color:"textSecondary",children:[" ","Drop Image Here"]}),u?e.jsx("p",{children:"Drop the files here ..."}):e.jsx("p",{children:"Drag 'n' drop some files here, or click to select files"})]})]}),e.jsxs(y,{size:4,children:[e.jsx(i,{variant:"overline",color:"secondary",children:"Step 2 - Resize Image"}),r.length>0&&e.jsx(_s,{ref:t,src:(S=r[0])==null?void 0:S.preview,style:{height:300,width:"100%"},initialAspectRatio:1,aspectRatio:1,guides:!1,viewMode:1,dragMode:"move",cropBoxResizable:!1,preview:".img-preview",background:!1})]}),e.jsx(y,{size:4,children:r.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"overline",color:"secondary",children:"Step 3 - Preview and Upload"}),e.jsx("div",{className:"img-preview",style:{width:300,height:300,overflow:"hidden"}}),e.jsx(w,{variant:"contained",color:"secondary",onClick:d,disabled:n,sx:{width:300,my:1},children:n?"Uploading...":"Upload Image"})]})})]})}function Fn({isStarred:s}){return e.jsx(c,{children:e.jsxs(w,{sx:{border:"none",cursor:"pointer",position:"relative",transition:"transform 0.2s"},children:[e.jsx(ys,{sx:{color:"white",fontSize:28,position:"absolute"}}),e.jsx(ws,{sx:{color:s?"yellow":"rgba(0, 0, 0, 0.54)",fontSize:28,cursor:"pointer"}})]})})}function kn(){return e.jsx(c,{children:e.jsxs(w,{sx:{border:"none",cursor:"pointer",position:"relative",transition:"transform 0.2s"},children:[e.jsx(Cs,{sx:{color:"white",fontSize:28,position:"absolute"}}),e.jsx(vs,{sx:{color:"red",fontSize:28,cursor:"pointer"}})]})})}function zn(){const{id:s}=U(),{photos:n,isLoadingPhoto:r,isCurrentUser:o,uploadPhoto:t,profile:a,setMainPhoto:d,deletePhoto:p}=M(s),[h,u]=f.useState(!1),S=j=>{t.mutate(j,{onSuccess:()=>{u(!1)}})};return r?e.jsx(i,{children:"Loading..."}):e.jsxs(c,{children:[e.jsxs(c,{display:"flex",justifyContent:"space-between",mb:2,children:[e.jsx(i,{variant:"h5",children:"Photos"}),o&&e.jsx(w,{variant:"contained",color:"primary",onClick:()=>u(!h),children:h?"Cancel":"Add Photo"})]}),e.jsx(E,{sx:{mb:2}}),h?e.jsx(Pn,{uploadPhoto:S,loading:t.isLoading}):e.jsxs(e.Fragment,{children:[(n==null?void 0:n.length)===0&&e.jsx(i,{children:"No photos added yet"}),e.jsx(Ss,{sx:{height:450},cols:6,rowHeight:164,children:(n??[]).map(j=>e.jsxs(Is,{children:[e.jsx("img",{srcSet:`${j.url.replace("upload","upload/w_164,h_164,dpr_2,g_face,c_fill,f_auto")}`,src:`${j.url.replace("upload","upload/w_164,h_164,dpr_2,g_face,c_fill,f_auto")}`,alt:"user-photo",loading:"lazy"}),o&&e.jsxs("div",{children:[e.jsx(c,{sx:{position:"absolute",top:0,right:0},onClick:()=>d.mutate(j),children:e.jsx(Fn,{isStarred:j.url===(a==null?void 0:a.imageUrl)})}),(a==null?void 0:a.imageUrl)!==j.url&&e.jsx(c,{sx:{position:"absolute",top:0,left:0,alignSelf:"flex-start"},onClick:()=>p.mutate(j.id),children:e.jsx(kn,{})})]})]},j.id))})]})]})}const Rn=A.object({displayName:q("displayName"),bio:A.string().optional()});function En({setEditMode:s}){const{id:n}=U(),{profile:r,editProfile:o}=M(n),{handleSubmit:t,reset:a,control:d}=J({resolver:se(Rn),mode:"onTouched"}),[p,h]=f.useState((r==null?void 0:r.displayName)||""),u=x=>{h(x.target.value)},[S,j]=f.useState((r==null?void 0:r.bio)||""),I=x=>{j(x.target.value)};f.useEffect(()=>{r&&a({...r})},[r,a]);const L=x=>{try{if(x){if(!(r!=null&&r.id)){console.error("Profile ID is missing");return}const F={...r,...x,id:r.id};o.mutate(F,{onSuccess:()=>{s(!1)},onError:$=>{console.log($)}})}else console.log("Profile data is not available")}catch(F){console.log(F)}};return e.jsx(P,{children:e.jsxs(c,{component:"form",display:"flex",marginTop:1,gap:2,flexDirection:"column",autoComplete:"off",onSubmit:t(L),children:[e.jsx(T,{label:"Display Name",name:"displayName",value:p,onChange:u,fullWidth:!0,variant:"outlined",control:d}),e.jsx(T,{label:"Bio",value:S,onChange:I,name:"bio",multiline:!0,rows:7,control:d}),e.jsx(c,{sx:{display:"flex",justifyContent:"right",pb:2},justifyContent:"space-between",marginTop:2,children:e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mr:2},children:e.jsx(w,{variant:"contained",color:"primary",type:"submit",disabled:o.isLoading||(r==null?void 0:r.displayName)===p&&(r==null?void 0:r.bio)===S,children:"Update Profile"})})})]})})}function Un(){const{id:s}=U(),[n,r]=f.useState(!1),{profile:o,isCurrentUser:t}=M(s);return e.jsxs(c,{children:[e.jsxs(c,{display:"flex",justifyContent:"space-between",children:[e.jsxs(i,{variant:"h5",children:["About ",o==null?void 0:o.displayName]}),t&&e.jsx(w,{onClick:()=>r(!n),children:n?e.jsx(i,{variant:"button",color:"error",children:"Cancel"}):"Edit"})]}),e.jsx(E,{sx:{my:2}}),e.jsx(c,{sx:{overflow:"auto",maxHeight:350},children:n?e.jsx(En,{setEditMode:r}):e.jsx(i,{variant:"body1",sx:{whiteSpace:"pre-wrap"},children:(o==null?void 0:o.bio)||"No description added yet"})})]})}function Ce({activeTab:s}){const{id:n}=U(),r=s===3?"followers":"followings",{profile:o,followings:t,loadingFollowings:a}=M(n,r);return e.jsxs(c,{children:[e.jsx(c,{display:"flex",children:e.jsx(i,{variant:"h5",fontWeight:600,color:"primary.main",children:s===3?`People following ${o==null?void 0:o.displayName}`:`People ${o==null?void 0:o.displayName} is following`})}),e.jsx(E,{sx:{my:2}}),a?e.jsx(i,{children:"Loading..."}):e.jsx(c,{display:"flex",marginTop:3,children:(t??[]).length>0?(t??[]).map(d=>e.jsx(Ee,{profile:d},d.id)):e.jsxs(i,{children:["No ",r," yet!"]})})]})}function ae({userActivities:s}){return e.jsx(c,{children:e.jsx(y,{container:!0,spacing:2,sx:{height:400,overflowY:"auto"},children:e.jsx(y,{size:12,spacing:10,display:"flex",direction:"row",sx:{gap:2,p:2},children:s&&s.map(n=>e.jsx(D,{to:`/activities/${n.id}`,style:{textDecoration:"none"},children:e.jsxs(Y,{elevation:4,sx:{transition:"transform 0.3s ease-in-out","&:hover":{transform:"scale(1.05)"}},children:[e.jsx(xe,{component:"img",src:`/assets/categoryImages/${n.category}.jpg`,alt:`${n.category} image`,height:"100",sx:{objectFit:"cover"}}),e.jsxs(Us,{children:[e.jsx(i,{textAlign:"center",variant:"h6",children:n.title}),e.jsxs(i,{textAlign:"center",variant:"body2",display:"flex",flexDirection:"column",children:[e.jsx("span",{children:le(n.date,"do LLL yyyy")}),e.jsx("span",{children:le(n.date,"h:mm a")})]})]})]})},n.id))})})})}function Nn(){const{id:s}=U(),{userActivities:n,isLoadingUserActivities:r,setFilter:o}=M(s),[t,a]=f.useState("future"),d=(p,h)=>{a(h),o(h)};return f.useEffect(()=>{o(t)},[t,o]),e.jsx(c,{sx:{width:"100%",typography:"body1"},children:e.jsxs(Ds,{value:t,children:[e.jsx(c,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Ls,{onChange:d,"aria-label":"lab API tabs example",children:[e.jsx(Z,{label:"Future Events",value:"future"}),e.jsx(Z,{label:"Past Events",value:"past"}),e.jsx(Z,{label:"Hosting",value:"hosting"})]})}),e.jsx(oe,{value:"future",children:r?e.jsx(i,{children:"Loading..."}):e.jsx(ae,{userActivities:n||[]})}),e.jsx(oe,{value:"past",children:r?e.jsx(i,{children:"Loading..."}):e.jsx(ae,{userActivities:n||[]})}),e.jsx(oe,{value:"hosting",children:r?e.jsx(i,{children:"Loading..."}):e.jsx(ae,{userActivities:n||[]})})]})})}function Tn(){const[s,n]=f.useState(0),r=(t,a)=>{n(a)},o=[{label:"About",content:e.jsx(Un,{})},{label:"Photos",content:e.jsx(zn,{})},{label:"Events",content:e.jsx(Nn,{})},{label:"Followers",content:e.jsx(Ce,{activeTab:s})},{label:"Followings",content:e.jsx(Ce,{activeTab:s})}];return e.jsxs(c,{component:P,elevation:3,mt:2,height:500,sx:{display:"flex",alignItems:"flex-start",borderRadius:3},children:[e.jsx(As,{orientation:"vertical",value:s,onChange:r,sx:{borderRight:1,borderColor:"divider",width:200,height:450},children:o.map((t,a)=>e.jsx(Z,{label:t.label,sx:{mr:1}},a))}),e.jsx(c,{sx:{flexGrow:0,padding:3,tp:0,position:"relative",width:"100%"},children:o[s].content})]})}function $n(){const{id:s}=U(),{profile:n,isLoadingProfile:r}=M(s);return r?e.jsx(i,{children:"Loading..."}):n?e.jsx(y,{children:e.jsxs(y,{direction:"column",container:!0,sx:{marginTop:2},children:[e.jsx(An,{}),e.jsx(Tn,{})]})}):e.jsx(i,{children:"Profile not found"})}const ce=Qe([{path:"/",element:e.jsx(Xs,{}),children:[{element:e.jsx(In,{}),children:[{path:"activities",element:e.jsx(on,{})},{path:"activities/:id",element:e.jsx(jn,{})},{path:"createActivity",element:e.jsx(we,{},"create")},{path:"manage/:id",element:e.jsx(we,{})},{path:"profiles/:id",element:e.jsx($n,{})}]},{path:"",element:e.jsx(Re,{})},{path:"counter",element:e.jsx(bn,{})},{path:"errors",element:e.jsx(yn,{})},{path:"/not-found",element:e.jsx(wn,{})},{path:"/server-error",element:e.jsx(Cn,{})},{path:"/login",element:e.jsx(Sn,{})},{path:"/register",element:e.jsx(Ln,{})},{path:"*",element:e.jsx(Ie,{replace:!0,to:"/not-found"})}]}]),Wn=new qe;Te.createRoot(document.getElementById("root")).render(e.jsx(f.StrictMode,{children:e.jsx(Ps,{dateAdapter:Fs,children:e.jsx(ze.Provider,{value:R,children:e.jsxs(Be,{client:Wn,children:[e.jsx(Me,{}),e.jsx($e,{position:"bottom-right",autoClose:3e3,hideProgressBar:!0,theme:"colored"}),e.jsx(Oe,{router:ce})]})})})}));
