var Ne=Object.defineProperty;var Te=(n,s,r)=>s in n?Ne(n,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[s]=r;var z=(n,s,r)=>Te(n,typeof s!="symbol"?s+"":s,r);import{j as e,r as p}from"./react-BgDqD0BF.js";import{c as We}from"./react-dom-B76qEhqe.js";import{y as Q,L as Be}from"./react-toastify-Cd5VntY5.js";import{u as ue,a as O,b as k,c as $e,Q as qe,d as Me,R as He}from"./@tanstack-EF--InMw.js";import{N as ve,u as xe,L as D,a as Y,S as Qe,O as Se,b as W,c as Pe,d as Oe,e as Ve,R as Ke}from"./react-router-DrXbiubp.js";import{M as N,B as C,a as l,A as K,b as _e,L as X,c as Ge,d as M,P as Ie,e as Ye,D as R,f as Je,g as Ze,C as Ae,T as Xe,h as i,i as De,j as F,k as J,l as he,m as ne,n as V,o as en,p as nn,q as sn,r as Fe,s as rn,F as tn,t as on,E as an,G as w,u as me,v as ln,I as cn,S as dn,w as un,x as xn,y as hn,z as ke,H as mn,J as ge,K as gn,N as pn,O as fn,Q as jn,R as bn,U as yn,V as wn,W as Le,X as Cn,Y as be,Z as vn,_ as Sn,$ as Pn,a0 as In,a1 as An,a2 as Dn,a3 as Fn,a4 as kn,a5 as Ln,a6 as ee,a7 as ie,a8 as En,a9 as Rn,aa as zn,ab as Un}from"./@mui-0-b_O-z_.js";import{O as Nn,o as se,u as Tn}from"./mobx-react-lite-BTwHq6E8.js";import{a as pe,r as ye}from"./mobx-xjmfNSXz.js";import{a as Ee}from"./axios-xsH4HHeE.js";import{z as L}from"./zod-C4bLmoCR.js";import{S as Wn,f as ce}from"./date-fns-CJWB21-A.js";import{u as Bn}from"./react-intersection-observer-CR7J_zgx.js";import{C as $n}from"./react-calendar-B4wrolSb.js";import{u as qn,b as re,c as _,F as Mn}from"./react-hook-form-_F_gE8Se.js";import{s as Z}from"./@hookform-DEvFLUYq.js";import{l as Hn,m as Qn}from"./leaflet-C5JgwxMT.js";import{M as On,T as Vn,a as Kn,P as _n}from"./react-leaflet-B2zthTho.js";import{H as Gn}from"./@microsoft-JXRn2a9-.js";import{u as Yn}from"./react-dropzone-BntINOXS.js";import{l as Jn}from"./react-cropper-DzVgjz3L.js";import"./cropperjs-Bq9aDmdf.js";import"./attr-accept-DacPH0-p.js";import"./scheduler-SPyfQU6S.js";import"./clsx-B-dksMZM.js";import"./cookie--_YQFYBD.js";import"./@babel-BtohYyOd.js";import"./prop-types-CyT9pI1Q.js";import"./@emotion-Bb6mt2UZ.js";import"./hoist-non-react-statics-C-Qo8PK8.js";import"./stylis-DDa9OTMq.js";import"./react-transition-group-CPBwl8KG.js";import"./dom-helpers-D0mFdbeO.js";import"./@popperjs-CMBiYTiD.js";import"./react-is-BPJnJB5S.js";import"./use-sync-external-store-CyJQA7jq.js";import"./get-user-locale-dEcy---E.js";import"./mem-682X8IXo.js";import"./mimic-fn-kh_GziL3.js";import"./map-age-cleaner-B1I_vRRc.js";import"./p-defer-BUV9kL4s.js";import"./@wojtekmaj-AYOw5BZR.js";import"./@react-leaflet-3bGK7VMe.js";import"./file-selector-CEwG-fuv.js";import"./tslib-6vuVcGup.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function r(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(t){if(t.ep)return;t.ep=!0;const a=r(t);fetch(t.href,a)}})();function G({children:n,to:s}){return e.jsx(N,{component:ve,to:s,sx:{textDecoration:"none",fontSize:"1.2rem",textTransform:"uppercase",fontWeight:"bold",color:"inherit","&.active":{backgroundColor:"#1e90ff",color:"#ff7f50"},"&:hover":{backgroundColor:"#1e90ff",color:"#1976d2"},border:"none",padding:"10px 20px",borderRadius:"5px",transition:"all 0.3s ease-in-out",cursor:"pointer"},children:n})}class Zn{constructor(){z(this,"count",0);z(this,"title","Counter Store");z(this,"increment",(s=1)=>{this.count+=s});z(this,"decrement",(s=1)=>{this.count-=s});pe(this)}}class Xn{constructor(){z(this,"isLoading",!1);pe(this)}isBusy(){this.isLoading=!0}isIdle(){this.isLoading=!1}}class es{constructor(){z(this,"filter","all");z(this,"startDate",new Date().toISOString());z(this,"setFilter",s=>{this.filter=s});z(this,"setStartDate",s=>{this.startDate=s.toISOString()});pe(this)}}const U={counterStore:new Zn,UIStore:new Xn,activityStore:new es},Re=p.createContext(U);function te(){return p.useContext(Re)}const v=Ee.create({baseURL:"/api",timeout:1e4,withCredentials:!0});v.interceptors.request.use(n=>(U.UIStore.isBusy(),n));v.interceptors.response.use(async n=>{switch(n.status){case 200:case 201:return U.UIStore.isIdle(),n;case 204:return U.UIStore.isIdle(),Promise.resolve({});default:return Promise.reject(n.data)}},async n=>{var o,t;const s=(o=n.response)==null?void 0:o.status,r=(t=n.response)==null?void 0:t.data;switch(s){case 401:{if(r.detail==="NotAllowed")throw new Error(r.detail);Q.error("Unauthorized"),U.UIStore.isIdle();break}case 403:{Q.error("Forbidden"),U.UIStore.isIdle();break}case 404:{de.navigate("/not-found");break}case 400:case 422:if(r!=null&&r.errors){const a=[];for(const d in r.errors)r.errors[d]&&a.push(r.errors[d]);throw U.UIStore.isIdle(),a.flat()}else r&&Q.error(r);U.UIStore.isIdle();break;case 500:{de.navigate("/server-error",{state:{error:r}});break}default:Q.error("An unexpected error occurred");break}return U.UIStore.isIdle(),Promise.reject(r)});const B=()=>{const n=ue(),s=xe(),{data:r,isLoading:o}=O({queryKey:["user"],queryFn:async()=>(await v.get("/account/user-info")).data,enabled:!n.getQueryData(["user"])}),t=k({mutationFn:async j=>{await v.post("/login?useCookies=true",j)},onSuccess:async()=>{await n.invalidateQueries({queryKey:["user"]})}}),a=k({mutationFn:async()=>{await v.post("/account/logout")},onSuccess:()=>{n.removeQueries({queryKey:["user"]}),n.removeQueries({queryKey:["activities"]}),s("/")}}),d=k({mutationFn:async j=>{await v.post("/account/register",j)}}),u=k({mutationFn:async({userId:j,code:h})=>{await v.get(`/confirmEmail?userId=${j}&code=${h}`)}}),f=k({mutationFn:async({email:j,userId:h})=>{await v.get("/account/resendConfirmEmail",{params:{email:j,userId:h}})},onSuccess:()=>{Q.success("Email sent - Please check your inbox")}}),x=k({mutationFn:async j=>{await v.put("/account/change-password",j)}});return{loginUser:t,currentUser:r,logoutUser:a,loadingUserInfo:o,registerUser:d,verifyEmail:u,resendConfirmationEmail:f,changePassword:x}};function ns(){const[n,s]=p.useState(null),r=!!n,o=u=>{s(u.currentTarget)},t=()=>{s(null)},{currentUser:a,logoutUser:d}=B();return e.jsxs(e.Fragment,{children:[e.jsx(C,{onClick:o,color:"inherit",size:"large",sx:{fontSize:"1.1rem"},children:e.jsxs(l,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(K,{src:a==null?void 0:a.imageUrl,alt:"Logged in User"}),a==null?void 0:a.displayName]})}),e.jsxs(_e,{id:"basic-menu",anchorEl:n,open:r,onClose:t,slotProps:{list:"basic-button"},children:[e.jsxs(N,{component:D,to:"/createActivity",onClick:t,children:[e.jsx(X,{children:e.jsx(Ge,{})}),e.jsx(M,{children:"Create Activity"})]}),e.jsxs(N,{component:D,to:`/profiles/${a==null?void 0:a.id}`,onClick:t,children:[e.jsx(X,{children:e.jsx(Ie,{})}),e.jsx(M,{children:"My Profile"})]}),e.jsxs(N,{component:D,to:"/change-password",onClick:t,children:[e.jsx(X,{children:e.jsx(Ye,{})}),e.jsx(M,{children:"Change Password"})]}),e.jsx(R,{style:{margin:"0.5rem 0"}}),e.jsxs(N,{onClick:()=>{d.mutate(),t()},children:[e.jsx(X,{children:e.jsx(Je,{})}),e.jsx(M,{children:"Logout"})]})]})]})}function ss(){const{currentUser:n}=B(),{UIStore:s}=te();return e.jsx(l,{sx:{display:"flex"},children:e.jsx(Ze,{position:"fixed",sx:{backgroundImage:"linear-gradient(135deg, #182a73 0%, #218aae 69%, #20a7ac 89%)"},children:e.jsx(Ae,{maxWidth:"lg",sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsxs(Xe,{variant:"dense",sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsx(l,{sx:{display:"flex",alignItems:"center",gap:2},children:e.jsxs(N,{component:ve,to:"/",sx:{display:"flex",alignItems:"center",textTransform:"uppercase",fontSize:"1.2rem",fontWeight:"bold"},children:[e.jsx("img",{src:"/assets/logo.png",alt:"Logo",style:{width:"50px",height:"50px",marginRight:"1rem"}}),e.jsx(i,{variant:"h4",fontWeight:"bold",style:{color:"#fff",position:"relative"},children:"Reactivities"}),e.jsx(Nn,{children:()=>s.isLoading?e.jsx(De,{size:20,thickness:7,sx:{color:"#fff",position:"absolute",top:"30%",left:"105%"},color:"secondary"}):null})]})}),e.jsxs(l,{sx:{display:"flex",gap:2},children:[e.jsx(G,{to:"/activities",children:e.jsx(i,{fontWeight:"bold",style:{color:"#fff"},children:"Activities"})}),e.jsx(G,{to:"/counter",children:e.jsx(i,{fontWeight:"bold",style:{color:"#fff"},children:"Counter"})}),e.jsx(G,{to:"/errors",children:e.jsx(i,{fontWeight:"bold",style:{color:"#fff"},children:"Errors"})})]}),e.jsx(l,{display:"flex",alignItems:"center",children:n?e.jsx(ns,{}):e.jsxs(e.Fragment,{children:[e.jsx(G,{to:"/login",children:e.jsx(i,{fontWeight:"bold",style:{color:"#fff"},children:"Login"})}),e.jsx(G,{to:"/register",children:e.jsx(i,{fontWeight:"bold",style:{color:"#fff"},children:"Register"})})]})})]})})})})}function ze(){return e.jsx(F,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",backgroundColor:"#f5f5f5",gap:6,backgroundImage:"linear-gradient(135deg, #182a73 0%, #218aae 69%, #20a7ac 89%)"},children:e.jsxs(l,{sx:{alignItems:"center",alignContent:"center",color:"#fff"},children:[e.jsx("img",{src:"/assets/logo.png",alt:"Logo",style:{width:"150px",height:"150px",marginBottom:"1rem"}}),e.jsx(i,{variant:"h1",fontWeight:"bold",style:{color:"#fff"},children:"Reactivities"}),e.jsx(i,{variant:"h3",fontWeight:"bold",children:"Welcome to Reactivities"}),e.jsx(C,{variant:"contained",color:"primary",sx:{marginTop:"1rem",backgroundColor:"#fff",color:"#182a73",fontWeight:"bold"},component:D,to:"/activities",children:"Take me to Activities"})]})})}function rs(){const n=Y();return e.jsxs(l,{sx:{display:"flex",flexDirection:"column",height:"100vh",bgcolor:"#f5f5f5"},children:[e.jsx(Qe,{}),n.pathname==="/"?e.jsx(l,{sx:{flexGrow:1,bgcolor:"#f5f5f5"},children:e.jsx(ze,{})}):e.jsxs(e.Fragment,{children:[e.jsx(ss,{}),e.jsx(Ae,{maxWidth:"xl",sx:{flexGrow:1,padding:"5rem",bgcolor:"#f5f5f5"},children:e.jsx(Se,{})})]})]})}function fe(n){return ce(n,"dd MMM yyyy h:mm a")}function ts(n){return Wn(n)+" ago"}const T=n=>L.string({required_error:`${n} is Required`}).min(3,{message:`${n} is requires minimum 3 characters`});function Ue({profile:n}){return e.jsx(D,{to:`/profiles/${n.id}`,style:{textDecoration:"none"},children:e.jsxs(J,{elevation:2,sx:{borderRadius:3,p:3,boxShadow:3,textDecoration:"none",maxWidth:200},children:[e.jsx(he,{component:"img",src:(n==null?void 0:n.imageUrl)||"/assets/user.png",alt:(n==null?void 0:n.displayName)+" image",sx:{width:"100%",zIndex:50}}),e.jsx(ne,{sx:{display:"flex",flexDirection:"column",alignItems:"left",textAlign:"left",fullwidth:"100%",justifyContent:"space-between"},children:e.jsxs(l,{display:"flex",flexDirection:"column",gap:1,sx:{mb:1},children:[e.jsx(i,{variant:"h5",children:n==null?void 0:n.displayName}),n.bio&&e.jsx(i,{variant:"body2",sx:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",maxWidth:250},children:n.bio}),(n==null?void 0:n.isFollowing)&&e.jsx(V,{label:"Following",color:"secondary",variant:"outlined",size:"small",sx:{fontSize:"0.8rem",borderRadius:2}})]})}),e.jsx(R,{sx:{mb:2}}),e.jsxs(l,{display:"flex",gap:2,sx:{alignItems:"center",justifyContent:"start"},children:[e.jsx(Ie,{}),e.jsxs(i,{children:[n==null?void 0:n.followersCount," Followers"]})]})]})})}function os({profile:n}){const[s,r]=p.useState(null),o=d=>{r(d.currentTarget)},t=()=>{r(null)},a=!!s;return e.jsxs(e.Fragment,{children:[e.jsx(K,{src:n.imageUrl,alt:n.displayName+" image",component:D,to:`/profiles/${n.id}`,onMouseEnter:o,onMouseLeave:t,sx:{border:n.isFollowing?"2px solid orange":"none",borderColor:"secondary.main"}}),e.jsx(en,{id:"mouse-over-popover",open:a,anchorEl:s,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},onClose:t,disableRestoreFocus:!0,sx:{cursor:"pointer",marginRight:1,pointerEvents:"none"},children:e.jsx(Ue,{profile:n})})]})}function is({activity:n}){const s=n.isHost?"You are hosting":"You are going",r=n.isHost?"secondary":n.isGoing?"warning":"default";return e.jsxs(J,{elevation:2,sx:{borderRadius:3,boxShadow:3,marginBottom:2},children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{padding:1},children:[e.jsx(nn,{avatar:e.jsx(K,{sx:{height:80,width:80},src:n.hostImageUrl,alt:"Host Image"}),title:n.title,subheader:e.jsxs(e.Fragment,{children:["Hosted By"," "," ",e.jsx(D,{to:`/profiles/${n.hostId}`,style:{textDecoration:"none",color:"text.primary"},children:n.hostDisplayName})]})}),e.jsxs(l,{display:"flex",flexDirection:"column",sx:{mr:2,gap:2,backgroundColor:r,borderRadius:1,padding:.5,color:"white",fontSize:"0.8rem",fontWeight:"bold"},children:[(n.isGoing||n.isHost)&&e.jsx(V,{label:s,variant:"outlined",color:r,size:"small",sx:{fontSize:"0.8rem",borderRadius:2}}),n.isCancelled&&e.jsx(V,{label:"Cancelled",color:"error",size:"small",sx:{fontSize:"0.8rem",borderRadius:2}})]})]}),e.jsx(R,{sx:{mb:3}}),e.jsxs(ne,{sx:{padding:0},children:[e.jsxs(l,{display:"flex",alignItems:"center",sx:{mb:2,px:2},children:[e.jsxs(l,{display:"flex",alignItems:"center",gap:0,children:[e.jsx(sn,{sx:{color:"text.primary",mr:1,display:"flex"}}),e.jsx(i,{variant:"body2",color:"text.primary",noWrap:!0,children:n.date?fe(n.date):"Date not available"})]}),e.jsx(Fe,{sx:{ml:3,mr:1}}),e.jsxs(i,{variant:"body2",children:[" ",n.venue]})]}),e.jsx(R,{}),e.jsx(l,{display:"flex",gap:2,sx:{backgroundColor:"grey.200",py:3,pl:3},children:n.attendees.map(o=>e.jsx(os,{profile:o},o.id))}),e.jsx(rn,{sx:{display:"flex",ml:1},children:e.jsx(i,{variant:"body2",color:"text.secondary",children:n.description})}),e.jsx(l,{display:"flex",justifyContent:"flex-end",sx:{padding:1},children:e.jsx(C,{component:D,to:`/activities/${n.id}`,variant:"contained",color:"primary",size:"medium",sx:{textTransform:"none",justifySelf:"self-end",borderRadius:3},children:e.jsx(i,{style:{color:"white"},children:"View"})})})]})]})}const oe=n=>{const s=ue(),{currentUser:r}=B(),o=Y(),{activityStore:{filter:t,startDate:a}}=te(),{data:d,isLoading:u,isFetchingNextPage:f,fetchNextPage:x,hasNextPage:j}=$e({queryKey:["activities",t,a],queryFn:async({pageParam:g=null})=>(await v.get("/activities",{params:{cursor:g,pageSize:3,filter:t,startDate:a}})).data,getNextPageParam:g=>g.nextCursor,getPreviousPageParam:g=>g.nextCursor,initialPageParam:null,enabled:!n&&o.pathname==="/activities"&&!!r,select:g=>({...g,pages:g.pages.map(I=>({...I,items:I.items.map(c=>{const b=c.attendees.find(y=>y.id===c.hostId);return{...c,isHost:(r==null?void 0:r.id)===c.hostId,isGoing:c.attendees.some(y=>y.id===(r==null?void 0:r.id)),hostImageUrl:(b==null?void 0:b.imageUrl)||""}})}))})}),{data:h,isLoading:P}=O({queryKey:["activities",n],queryFn:async()=>(await v.get(`/activities/${n}`)).data,enabled:!!n&&!!r,select:g=>{const I=g.attendees.find(c=>c.id===g.hostId);return{...g,isHost:(r==null?void 0:r.id)===g.hostId,isGoing:g.attendees.some(c=>c.id===(r==null?void 0:r.id)),hostImageUrl:I==null?void 0:I.imageUrl}}}),S=k({mutationFn:async g=>(await v.post("/activities",g)).data,onSuccess:async()=>{await s.invalidateQueries({queryKey:["activities"]})},onError:g=>{console.error("Error creating activity:",g)}}),m=k({mutationFn:async g=>(await v.put(`/activities/${g.id}`,g)).data,onSuccess:async()=>{await s.invalidateQueries({queryKey:["activities"]})}}),A=k({mutationFn:async g=>(await v.delete(`/activities/${g}`)).data,onSuccess:async()=>{await s.invalidateQueries({queryKey:["activities"]})}}),$=k({mutationFn:async g=>(await v.post(`/activities/${g}/attend`,{})).data,onMutate:async g=>{await s.cancelQueries({queryKey:["activities",g]});const I=s.getQueryData(["activities",g]);return s.setQueryData(["activities",g],c=>{if(!c||!r)return c;const b=r.id===c.hostId,y=c.attendees.some(q=>q.id===r.id);return{...c,isCancelled:b?!c.isCancelled:c.isCancelled,attendees:y?b?c.attendees:c.attendees.filter(q=>q.id!==r.id):[...c.attendees,{id:r.id,displayName:r.displayName,imageUrl:r.imageUrl,username:r.email||"",following:!1,followersCount:0,followingCount:0}]}}),{previousActivity:I}},onError:(g,I,c)=>{console.error("Error updating attendance:",g),c!=null&&c.previousActivity&&s.setQueryData(["activities",I],c==null?void 0:c.previousActivity)}});return{activitiesGroup:d,createActivity:S,updateActivity:m,deleteActivity:A,isLoading:u,isLoadingActivity:P,activity:h,updateAttendance:$,isFetchingNextPage:f,fetchNextPage:x,hasNextPage:j}},as=se(function(){const{activitiesGroup:s,isLoading:r,hasNextPage:o,fetchNextPage:t}=oe(),{ref:a,inView:d}=Bn({threshold:.5});return p.useEffect(()=>{d&&o&&t()},[d,o,t]),s?r?e.jsx(i,{children:"Loading..."}):e.jsx(l,{children:s.pages.map((u,f)=>e.jsx(l,{ref:f===s.pages.length-1?a:null,display:"flex",flexDirection:"column",gap:3,children:u==null?void 0:u.items.map(x=>e.jsx(is,{activity:{...x,hostImageUrl:x.hostImageUrl??""}},x.id))},f))}):e.jsx(i,{children:"No activities found."})}),ls=se(function(){const{activityStore:{setFilter:s,setStartDate:r,filter:o,startDate:t}}=te();return e.jsxs(l,{sx:{position:"sticky",top:"7rem",alignSelf:"flex-start",display:"flex",flexDirection:"column",gap:3,borderRadius:3},children:[e.jsx(F,{sx:{padding:3,borderRadius:3,backgroundColor:"#f5f5f5"},children:e.jsxs(l,{sx:{width:"100%"},children:[e.jsxs(i,{variant:"h5",sx:{fontWeight:"bold",mb:1,alignItems:"center",display:"flex",gap:1,color:"primary.main"},children:[e.jsx(tn,{sx:{color:"#333",mr:1}}),"Filters"]}),e.jsxs(on,{children:[e.jsx(N,{selected:o==="all",onClick:()=>s("all"),children:e.jsx(M,{primary:"All Events"})}),e.jsx(N,{selected:o==="isGoing",onClick:()=>s("isGoing"),children:e.jsx(M,{primary:"I'm Going"})}),e.jsx(N,{selected:o==="isHost",onClick:()=>s("isHost"),children:e.jsx(M,{primary:"I'm Hosting"})})]})]})}),e.jsxs(l,{component:F,sx:{padding:3,borderRadius:3,width:"100%"},children:[e.jsxs(i,{variant:"h5",sx:{fontWeight:"bold",mb:1,alignItems:"center",display:"flex",gap:1,color:"primary.main"},children:[e.jsx(an,{sx:{color:"#333",mr:1}}),"Select Date"]}),e.jsx($n,{value:t||new Date,onChange:a=>r(a)})]})]})});function cs(){return e.jsxs(w,{container:!0,spacing:2,sx:{marginTop:"2rem"},children:[e.jsx(w,{size:8,children:e.jsx(as,{})}),e.jsx(w,{size:4,children:e.jsx(ls,{})})]})}function E({control:n,...s}){var d;const r=qn(),o=n||(r==null?void 0:r.control);if(!o)throw new Error("TextInput must be used within a FormProvider or passed a control prop");const{field:t,fieldState:a}=re({...s,control:o});return e.jsx(me,{...s,...t,value:t.value||"",fullWidth:!0,onChange:u=>{t.onChange(u.target.value),s.onChange&&s.onChange(u)},variant:"outlined",error:!!a.error,helperText:(d=a.error)==null?void 0:d.message})}function ds(n){var o;const{field:s,fieldState:r}=re({...n});return e.jsxs(ln,{fullWidth:!0,error:!!r.error,children:[e.jsx(cn,{children:n.label}),e.jsx(dn,{value:s.value||"",label:n.label,onChange:s.onChange,children:n.items.map(t=>e.jsx(N,{value:t.value,children:t.text},t.value))}),e.jsx(un,{children:(o=r.error)==null?void 0:o.message})]})}const us=[{text:"Drinks",value:"drinks"},{text:"Culture",value:"culture"},{text:"Film",value:"film"},{text:"Food",value:"food"},{text:"Music",value:"music"},{text:"Travel",value:"travel"}];function xs(n){var o;const{field:s,fieldState:r}=re({...n});return e.jsx(xn,{...n,value:s.value?new Date(s.value):null,onChange:t=>{s.onChange(new Date(t))},sx:{width:"100%"},slotProps:{textField:{onBlur:s.onBlur,error:!!r.error,helperText:(o=r.error)==null?void 0:o.message}}})}function hs(n){var S;const{field:s,fieldState:r}=re({...n}),[o,t]=p.useState(!1),[a,d]=p.useState([]),[u,f]=p.useState(s.value||"");p.useEffect(()=>{s.value&&typeof s.value=="object"?f(s.value.venue||""):f(s.value||"")},[s.value]);const x="https://api.locationiq.com/v1/autocomplete?key=e24adf97ff7897&limit=5&dedupe=1&",j=p.useMemo(()=>hn(async m=>{if(!m||m.length<3){d([]);return}t(!0);try{const A=await Ee.get(`${x}q=${m}`);d(A.data)}catch(A){console.log(A),t(!1)}},500),[x]),h=async m=>{s.onChange(m),await j(m)},P=m=>{var c,b,y,q,je;const A=((c=m.address)==null?void 0:c.city)||((b=m.address)==null?void 0:b.town)||((y=m.address)==null?void 0:y.village)||((q=m.address)==null?void 0:q.county)||((je=m.address)==null?void 0:je.state),$=m.display_name,g=m.lat,I=m.lon;f($),s.onChange({city:A,venue:$,latitude:g,longitude:I}),d([]),t(!1)};return e.jsxs(l,{children:[e.jsx(me,{...n,value:u,label:"Location",variant:"outlined",fullWidth:!0,onChange:async m=>{h(m.target.value)},helperText:(S=r.error)==null?void 0:S.message,error:!!r.error}),o&&e.jsx(i,{children:"Loading..."}),a.length>0&&e.jsx(ke,{sx:{border:1},children:a.map(m=>e.jsx(mn,{divider:!0,onClick:()=>P(m),children:m.display_name},m.place_id))})]})}const ms=L.object({title:T("Title"),date:L.coerce.date({message:"Date is Required"}),description:T("Description"),category:T("Category"),location:L.object({city:L.string().optional(),venue:T("Venue"),latitude:L.coerce.number(),longitude:L.coerce.number()})});function we(){const{id:n}=W(),{updateActivity:s,createActivity:r,activity:o}=oe(n),t=xe(),{reset:a,handleSubmit:d,control:u}=_({resolver:Z(ms),mode:"onTouched"});p.useEffect(()=>{o&&a({...o,date:o.date||void 0,location:{city:o.city,venue:o.venue,latitude:o.latitude,longitude:o.longitude}})},[o,a]);const f=x=>{const{location:j,...h}=x,P={...h,...j};try{o?s.mutate({...o,...P},{onSuccess:()=>t(`/activities/${o.id}`)}):r.mutate({...P,location:{...j,city:j.city||""}},{onSuccess:S=>{t(`/activities/${S}`)}})}catch(S){console.log(S)}};return e.jsxs(F,{elevation:3,sx:{borderRadius:3,padding:2,margin:1},children:[e.jsx(i,{variant:"h5",gutterBottom:!0,color:"primary",children:o!=null&&o.id?"Edit Activity":"Create Activity"}),e.jsxs(l,{component:"form",display:"flex",gap:2,flexDirection:"column",autoComplete:"off",onSubmit:d(f),children:[e.jsx(E,{label:"Title",control:u,name:"title"}),e.jsx(E,{label:"Description",name:"description",control:u,multiline:!0,rows:3}),e.jsxs(l,{display:"flex",gap:3,children:[e.jsx(ds,{items:us,label:"Category",name:"category",control:u}),e.jsx(xs,{label:"Date",control:u,name:"date"})]}),e.jsx(hs,{control:u,label:"Enter the location",name:"location"}),e.jsx(l,{sx:{display:"flex",justifyContent:"right",pb:2},justifyContent:"space-between",marginTop:2,children:e.jsxs(ge,{sx:{display:"flex",gap:2,borderRadius:3},children:[e.jsx(C,{onClick:()=>t(-1),variant:"contained",color:"inherit",children:"Cancel"}),e.jsx(C,{variant:"contained",color:"success",type:"submit",disabled:s.isPending||r.isPending,children:"Submit"})]})})]})]})}const ae=gn(C)(({theme:n})=>({"&.Mui-disabled":{backgroundColor:n.palette.grey[600],color:n.palette.common.white}}));function gs({activity:n}){const{updateAttendance:s}=oe(n==null?void 0:n.id);return e.jsxs(J,{sx:{position:"relative",mb:2,backgroundColor:"transparent",overflow:"hidden"},children:[(n==null?void 0:n.isCancelled)&&e.jsx(V,{sx:{position:"absolute",left:40,top:20,zIndex:1e3,borderRadius:1},color:"error",label:"Cancelled"}),e.jsx(he,{component:"img",height:"300",image:`/assets/categoryImages/${n==null?void 0:n.category}.jpg`,alt:`${n==null?void 0:n.category} image`}),e.jsxs(l,{sx:{position:"absolute",bottom:0,width:"100%",color:"white",padding:2,display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"flex-end",background:"linear-gradient(to top, rgba(0, 0, 0, 1.0), transparent)",boxSizing:"border-box"},children:[e.jsxs(l,{children:[e.jsx(i,{variant:"h4",sx:{fontWeight:"bold"},children:n==null?void 0:n.title}),e.jsx(i,{variant:"subtitle1",children:n!=null&&n.date?fe(n.date):"Date not available"}),e.jsxs(i,{variant:"subtitle2",children:["Hosted by ",e.jsx(D,{to:`/profiles/${n==null?void 0:n.hostId}`,style:{color:"white",fontWeight:"bold"},children:n==null?void 0:n.hostDisplayName})]})]}),e.jsx(l,{sx:{display:"flex",gap:2},children:n!=null&&n.isHost?e.jsxs(e.Fragment,{children:[e.jsx(ae,{variant:"contained",color:n!=null&&n.isCancelled?"success":"error",onClick:()=>(n==null?void 0:n.id)&&s.mutate(n.id),disabled:s.isPending||(n==null?void 0:n.isCancelled),children:e.jsx(i,{children:n!=null&&n.isCancelled?"Re-activate Activity":"Cancel Activity"})}),e.jsx(ae,{variant:"contained",color:"primary",component:D,to:`/manage/${n==null?void 0:n.id}`,disabled:n==null?void 0:n.isCancelled,children:e.jsx(i,{color:"White",children:"Manage Event"})})]}):e.jsx(ae,{variant:"contained",color:n!=null&&n.isGoing?"primary":"info",onClick:()=>(n==null?void 0:n.id)&&s.mutate(n.id),disabled:s.isPending||(n==null?void 0:n.isCancelled),children:n!=null&&n.isGoing?"Cancel Attendance":"Join Activity"})})]})]})}function ps({position:n,venue:s}){return e.jsxs(On,{center:n,zoom:13,scrollWheelZoom:!1,style:{height:"100%"},children:[e.jsx(Vn,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(Kn,{position:n,icon:new Hn.Icon({iconUrl:Qn,iconSize:[25,41],iconAnchor:[12,41]}),children:e.jsx(_n,{children:s})})]})}function fs({activity:n}){const[s,r]=p.useState(!1);return e.jsxs(F,{sx:{mb:2},children:[e.jsxs(w,{container:!0,alignItems:"center",pl:2,py:1,children:[e.jsx(w,{size:1,children:e.jsx(pn,{color:"info",fontSize:"large"})}),e.jsx(w,{size:11,children:e.jsx(i,{children:n==null?void 0:n.description})})]}),e.jsx(R,{}),e.jsxs(w,{container:!0,alignItems:"center",pl:2,py:1,children:[e.jsx(w,{size:1,children:e.jsx(fn,{color:"info",fontSize:"large"})}),e.jsx(w,{size:11,children:e.jsx(i,{children:n!=null&&n.date?fe(n.date):"Date not available"})})]}),e.jsx(R,{}),e.jsxs(w,{container:!0,alignItems:"center",pl:2,py:1,children:[e.jsx(w,{size:1,children:e.jsx(Fe,{color:"info",fontSize:"large"})}),e.jsxs(w,{size:11,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(i,{children:[n==null?void 0:n.venue,", ",n==null?void 0:n.city]}),e.jsx(C,{sx:{whiteSpace:"nowrap",mx:2},onClick:()=>{r(!s)},children:s?"Hide map":"Show map"})]})]}),s&&e.jsx(l,{sx:{height:300,zIndex:1e3,display:"block"},children:e.jsx(ps,{position:[(n==null?void 0:n.latitude)??0,(n==null?void 0:n.longitude)??0],venue:(n==null?void 0:n.venue)||"Unknown venue"})})]})}const js=n=>{const s=p.useRef(!1),r=Tn(()=>({comments:[],hubConnection:null,setHubConnection(o){o&&(this.hubConnection=new Gn().withUrl(`/comments?activityId=${o}`,{withCredentials:!0}).withAutomaticReconnect().build(),this.hubConnection.start().catch(t=>console.error("Error Establishing Hub Connection: ",t)),this.hubConnection.on("LoadComments",t=>{ye(()=>{this.comments=t})}),this.hubConnection.on("ReceiveComment",t=>{ye(()=>{this.comments.unshift(t)})}))},stopHubConnection(){this.hubConnection&&this.hubConnection.state==="Connected"&&this.hubConnection.stop().catch(o=>console.error("Error Stopping Hub Connection: ",o))}}));return p.useEffect(()=>(n&&!s.current&&(s.current=!0,r.setHubConnection(n)),()=>{r.stopHubConnection(),r.comments=[]}),[n]),{commentStore:r}},bs=se(function(){const{id:s}=W(),{commentStore:r}=js(s),{register:o,handleSubmit:t,reset:a,formState:{isSubmitting:d}}=_(),u=async x=>{var j;try{await((j=r.hubConnection)==null?void 0:j.invoke("SendComment",{activityId:s,body:x.body})),a()}catch(h){console.log(h)}},f=x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),t(u)())};return e.jsxs(e.Fragment,{children:[e.jsx(l,{sx:{textAlign:"center",bgcolor:"primary.main",color:"white",padding:2},children:e.jsx(i,{variant:"h6",children:"Chat about this event"})}),e.jsx(J,{children:e.jsxs(ne,{children:[e.jsx("div",{children:e.jsx("form",{children:e.jsx(me,{...o("body",{required:!0}),onKeyDown:f,variant:"outlined",fullWidth:!0,multiline:!0,rows:2,placeholder:"Enter your comment (Enter to submit, SHIFT + Enter for new line)",slotProps:{input:{endAdornment:d?e.jsx(De,{size:24}):null}}})})}),e.jsx(l,{sx:{height:400,overflowY:"auto",mt:1},children:r.comments.map(x=>e.jsxs(l,{sx:{display:"flex",my:2},children:[e.jsx(K,{src:x.imageUrl,alt:"user image",sx:{mr:2}}),e.jsxs(l,{display:"flex",flexDirection:"column",children:[e.jsxs(l,{display:"flex",alignItems:"center",gap:3,children:[e.jsx(i,{component:D,to:`/profiles/${x.userId}`,variant:"subtitle1",sx:{fontWeight:"bold",textDecoration:"none"},children:x.displayName}),e.jsx(i,{variant:"body2",color:"textSecondary",children:ts(x.createdAt)})]}),e.jsx(i,{sx:{whiteSpace:"pre-wrap"},children:x.body})]})]},x.id))})]})})]})});function ys({activity:n}){return e.jsxs(e.Fragment,{children:[e.jsx(F,{sx:{textAlign:"center",border:"none",backgroundColor:"primary.main",color:"white",p:2},children:e.jsxs(i,{variant:"h6",children:[n==null?void 0:n.attendees.length," ",(n==null?void 0:n.attendees.length)===1?"Person":"People"," Going"]})}),e.jsx(F,{sx:{padding:2},children:n==null?void 0:n.attendees.map(s=>e.jsxs(w,{container:!0,alignItems:"center",children:[e.jsx(w,{size:8,children:e.jsx(ke,{sx:{display:"flex",flexDirection:"column"},children:e.jsxs(jn,{component:D,to:`/profiles/${s.id}`,children:[e.jsx(bn,{children:e.jsx(K,{variant:"rounded",sx:{width:75,height:75,mr:3},alt:s.displayName,src:s.imageUrl})}),e.jsxs(M,{children:[e.jsx(i,{variant:"h6",children:s.displayName}),(s==null?void 0:s.isFollowing)&&e.jsx(i,{variant:"body2",color:"orange",children:"Following"})]})]})})}),e.jsx(w,{size:4,sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1},children:(n==null?void 0:n.hostId)===s.id&&e.jsx(V,{label:"Host",color:"warning",variant:"filled",sx:{borderRadius:2}})})]},s.id))})]})}function ws(){const{id:n}=W(),{activity:s,isLoadingActivity:r}=oe(n);return r?e.jsx(i,{variant:"h5",color:"primary",children:"Loading..."}):s?e.jsxs(w,{container:!0,spacing:3,children:[e.jsxs(w,{size:8,children:[e.jsx(gs,{activity:s}),e.jsx(fs,{activity:s}),e.jsx(bs,{})]}),e.jsx(w,{size:4,children:e.jsx(ys,{activity:s})})]}):e.jsx(i,{variant:"h5",color:"error",children:"Activity not found"})}const Cs=se(function(){const{counterStore:s}=te(),{count:r,title:o}=s;return console.log("Counter component rendered",r,o),e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"h4",color:"primary",gutterBottom:!0,children:o}),e.jsxs(i,{variant:"h6",color:"secondary",gutterBottom:!0,children:["Count: ",s.count]}),e.jsxs(ge,{variant:"contained",color:"primary","aria-label":"outlined primary button group",sx:{mt:2,p:2,gap:2},children:[e.jsx(C,{color:"primary",variant:"contained",onClick:()=>s.increment(1),children:"Increment"}),e.jsx(C,{color:"secondary",variant:"contained",onClick:()=>s.decrement(1),children:"Decrement"})]})]})});function vs(){const[n,s]=p.useState([]),{mutate:r}=k({mutationFn:async({path:t,method:a="get"})=>{a==="post"?await v.post(t,{}):await v.get(t)},onError:t=>{Array.isArray(t)?s(t):s([])}}),o=(t,a="get")=>{r({path:t,method:a})};return e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"h4",children:"Test errors component"}),e.jsxs(ge,{variant:"contained",sx:{mt:4},children:[e.jsx(C,{onClick:()=>o("buggy/not-found"),children:"Not found"}),e.jsx(C,{onClick:()=>o("buggy/bad-request"),children:"Bad request"}),e.jsx(C,{onClick:()=>o("activities","post"),children:"Validation error"}),e.jsx(C,{onClick:()=>o("buggy/server-error"),children:"Server error"}),e.jsx(C,{onClick:()=>o("buggy/unauthorised"),children:"Unauthorised"})]}),n.map((t,a)=>e.jsx(yn,{color:"error",severity:"error",children:t},a))]})}function Ss(){return e.jsxs(F,{elevation:3,sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:400},children:[e.jsx(wn,{sx:{fontSize:100,color:"primary"}}),e.jsx(i,{variant:"h3",sx:{mt:2},children:"We couldn't find what you are looking for."}),e.jsx(C,{variant:"contained",sx:{mt:2},component:D,to:"/activities",children:e.jsx(i,{color:"white",children:"Go back to activities"})})]})}function Ps(){const{state:n}=Y();return e.jsx(F,{children:n!=null&&n.error?e.jsxs(e.Fragment,{children:[e.jsx(i,{color:"error",gutterBottom:!0,variant:"h3",sx:{px:4,pt:2},children:n.error.message||"Internal Server error"}),e.jsx(R,{}),e.jsx(i,{gutterBottom:!0,variant:"body1",sx:{px:4},children:n.error.detail||"Internal Server error"})]}):e.jsx(i,{gutterBottom:!0,variant:"h3",sx:{px:4,pt:2},children:"Server error"})})}const Is=L.object({email:L.string().email(),password:L.string().min(6)});function As(){const[n,s]=p.useState(!1),{loginUser:r,resendConfirmationEmail:o}=B(),t=xe(),a=Y(),{control:d,watch:u,handleSubmit:f,formState:{isValid:x,isSubmitting:j}}=_({mode:"onTouched",resolver:Z(Is)}),h=u("email"),P=async()=>{await o.mutateAsync({email:h}).then(()=>{alert("Confirmation email sent")}).catch(m=>console.log(m)).finally(()=>s(!1))},S=async m=>{await r.mutateAsync(m,{onSuccess:()=>{var A;t(((A=a.state)==null?void 0:A.from)||"/activities")},onError:A=>{A.message==="NotAllowed"&&s(!0)}})};return e.jsxs(F,{component:"form",onSubmit:f(S),sx:{display:"flex",flexDirection:"column",p:3,gap:3,maxWidth:"md",mx:"auto",borderRadius:3},children:[e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"center",gap:3,color:"secondary.main",children:[e.jsx(Le,{fontSize:"large"}),e.jsx(i,{variant:"h4",children:"Sign in "})]}),e.jsx(E,{label:"Email",control:d,name:"email"}),e.jsx(E,{type:"password",label:"Password",control:d,name:"password"}),e.jsx(C,{type:"submit",disabled:!x||j,variant:"contained",size:"large",children:"Login"}),n?e.jsxs(l,{sx:{display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:[e.jsx(i,{textAlign:"center",color:"error",children:"Your email is not verified. Please check your inbox. Please click the button below to resend the verification email."}),e.jsx(C,{disabled:o.isPending,onClick:P,children:"Resend Verification Email"})]}):e.jsxs(i,{sx:{textAlign:"center"},children:["Don't have an account?",e.jsx(i,{component:D,to:"/register",color:"primary",sx:{ml:2},children:"Sign up"})]})]})}function Ds(){const{currentUser:n,loadingUserInfo:s}=B(),r=Y();return s?e.jsx(i,{children:"Loading..."}):n?e.jsx(Se,{}):e.jsx(Pe,{to:"/login",state:{from:r}})}const Fs=L.object({email:L.string().email(),displayName:T("displayName"),password:T("password")});function ks({email:n}){const{resendConfirmationEmail:s}=B();return n?e.jsxs(F,{elevation:3,sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:400,p:6},children:[e.jsx(Cn,{sx:{fontSize:100,color:"primary"}}),e.jsxs(i,{gutterBottom:!0,variant:"h3",sx:{mt:2,textAlign:"center"},children:["A confirmation email has been sent to ",n,". Please check your inbox."]}),e.jsx(C,{variant:"contained",sx:{mt:2},onClick:()=>s.mutate({email:n}),children:"Resend Confirmation Email"})]}):null}function Ls(){const{registerUser:n}=B(),[s,r]=p.useState(!1),{control:o,handleSubmit:t,setError:a,watch:d,formState:{isValid:u,isSubmitting:f}}=_({mode:"onTouched",resolver:Z(Fs)}),x=d("email"),j=async h=>{await n.mutateAsync(h,{onError(P){Array.isArray(P)&&P.forEach(S=>{S.includes("Email")?a("email",{message:S}):S.includes("Password")&&a("password",{message:S})})},onSuccess:()=>{r(!0)}})};return e.jsx(e.Fragment,{children:s?e.jsx(ks,{email:x}):e.jsxs(F,{component:"form",onSubmit:t(j),sx:{display:"flex",flexDirection:"column",p:3,gap:3,maxWidth:"md",mx:"auto",borderRadius:3},children:[e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"center",gap:3,color:"secondary.main",children:[e.jsx(Le,{fontSize:"large"}),e.jsx(i,{variant:"h4",children:"Register"})]}),e.jsx(E,{label:"Email",control:o,name:"email"}),e.jsx(E,{label:"Display Name",control:o,name:"displayName"}),e.jsx(E,{type:"password",label:"Password",control:o,name:"password"}),e.jsx(C,{type:"submit",disabled:!u||f,variant:"contained",size:"large",children:"Register"}),e.jsxs(i,{sx:{textAlign:"center"},children:["Already have an account?",e.jsx(i,{component:D,to:"/login",color:"primary",sx:{ml:2},children:"Sign in"})]})]})})}const H=(n,s)=>{const[r,o]=p.useState(null),t=ue(),{data:a,isLoading:d}=O({queryKey:["profile",n],queryFn:async()=>(await v.get(`/profiles/${n}`)).data,enabled:!!n&&!s}),{data:u,isLoading:f}=O({queryKey:["photos",n],queryFn:async()=>(await v.get(`/profiles/${n}/photos`)).data,enabled:!!n}),x=k({mutationFn:async()=>{await v.post(`/profiles/${n}/follow`)},onSuccess:async()=>{t.setQueryData(["profile",n],c=>(t.invalidateQueries({queryKey:["followings",n,"followers"]}),!c||c.followersCount===void 0?c:{...c,isFollowing:!c.isFollowing,followersCount:c.isFollowing?c.followersCount-1:c.followersCount+1}))}}),j=p.useMemo(()=>{var c;return n===((c=t.getQueryData(["user"]))==null?void 0:c.id)},[n,t]),{data:h,isLoading:P}=O({queryKey:["followings",n,s],queryFn:async()=>(await v.get(`/profiles/${n}/follow-list/?predicate=${s}`)).data,enabled:!!n&&!!s}),{data:S,isLoading:m}=O({queryKey:["user-activities",n,r],queryFn:async()=>(await v.get(`/profiles/${n}/activities`,{params:{filter:r}})).data,enabled:!!n&&!!r}),A=k({mutationFn:async c=>{const b=new FormData;return b.append("file",c),(await v.post("/profiles/add-photo",b,{headers:{"Content-Type":"multipart/form-data"}})).data},onSuccess:async c=>{await t.invalidateQueries({queryKey:["photos",n]}),t.setQueryData(["user"],b=>b&&{...b,imageUrl:b.imageUrl??c.url}),t.setQueryData(["profile",n],b=>b&&{...b,imageUrl:b.imageUrl??c.url})}}),$=k({mutationFn:async c=>{await v.put(`/profiles/${c.id}/set-main-photo`)},onSuccess:async(c,b)=>{await t.invalidateQueries({queryKey:["photos",b.id]}),t.setQueryData(["user"],y=>y&&{...y,imageUrl:b.url}),t.setQueryData(["profile",n],y=>y&&{...y,imageUrl:b.url})}}),g=k({mutationFn:async c=>{await v.delete(`/profiles/${c}/photos`)},onSuccess:async(c,b)=>{t.setQueryData(["photos",n],y=>y==null?void 0:y.filter(q=>q.id!==b))}}),I=k({mutationFn:async c=>{await v.put(`/profiles/${c.id}/edit-profile`,c)},onSuccess:async(c,b)=>{t.setQueryData(["profile",n],y=>y&&{...y,displayName:b.displayName,bio:b.bio}),t.setQueryData(["user"],y=>y&&{...y,displayName:b.displayName})}});return{profile:a,isLoadingProfile:d,photos:u,isLoadingPhoto:f,isCurrentUser:j,uploadPhoto:A,setMainPhoto:$,deletePhoto:g,editProfile:I,updateFollowing:x,followings:h,loadingFollowings:P,userActivities:S,isLoadingUserActivities:m,setFilter:o}};function Es(){const{id:n}=W(),{profile:s,isCurrentUser:r,updateFollowing:o}=H(n);return s?e.jsx(F,{elevation:4,sx:{padding:2,borderRadius:3},children:e.jsxs(w,{container:!0,alignItems:"center",children:[e.jsx(w,{size:8,children:e.jsxs(be,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(K,{sx:{width:150,height:150},src:s.imageUrl||"/assets/user.png",alt:s.displayName+" image"}),e.jsxs(l,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(i,{variant:"h4",fontWeight:700,children:s.displayName}),s.isFollowing&&e.jsx(V,{variant:"outlined",label:"Following",color:"secondary",sx:{borderRadius:1}})]})]})}),e.jsx(w,{size:4,children:e.jsxs(be,{spacing:2,alignItems:"center",children:[e.jsxs(l,{display:"flex",flexDirection:"row",gap:2,width:"100%",justifyContent:"space-around",children:[e.jsxs(l,{textAlign:"center",children:[e.jsx(i,{variant:"h6",fontWeight:700,children:"Followers"}),e.jsx(i,{variant:"h3",fontWeight:700,children:s.followersCount})]}),e.jsxs(l,{textAlign:"center",children:[e.jsx(i,{variant:"h6",fontWeight:700,children:"Following"}),e.jsx(i,{variant:"h3",fontWeight:700,children:s.followingsCount})]})]}),!r&&e.jsxs(e.Fragment,{children:[e.jsx(R,{sx:{width:"100%"}}),e.jsx(C,{onClick:()=>o.mutate(),variant:"outlined",color:s.isFollowing?"error":"primary",fullWidth:!0,children:s.isFollowing?"Unfollow":"Follow"})]})]})})]})}):e.jsx(i,{children:"Profile not found"})}function Rs({uploadPhoto:n,loading:s}){var j;const[r,o]=p.useState([]),t=p.useRef(null);p.useEffect(()=>{if(r.length>0)return()=>{r.forEach(h=>URL.revokeObjectURL(h.preview))}},[r]);const a=p.useCallback(h=>{o(h.map(P=>Object.assign(P,{preview:URL.createObjectURL(P)})))},[]),d=p.useCallback(()=>{var P;const h=(P=t.current)==null?void 0:P.cropper;h&&h.getCroppedCanvas().toBlob(S=>{S&&n(S)},"image/jpeg",.8)},[n]),{getRootProps:u,getInputProps:f,isDragActive:x}=Yn({onDrop:a});return e.jsxs(w,{container:!0,spacing:5,children:[e.jsxs(w,{size:4,children:[e.jsx(i,{variant:"overline",color:"secondary",children:"Step 1 - Add Photo"}),e.jsxs(l,{...u(),sx:{border:"2px dashed grey",borderRadius:2,padding:2,textAlign:"center",cursor:"pointer",height:"280px",backgroundColor:x?"lightblue":"white","&:hover":{backgroundColor:x?"lightblue":"#f0f0f0"}},children:[e.jsx("input",{...f()}),e.jsx(vn,{fontSize:"large",color:"action"}),e.jsxs(i,{variant:"h5",color:"textSecondary",children:[" ","Drop Image Here"]}),x?e.jsx("p",{children:"Drop the files here ..."}):e.jsx("p",{children:"Drag 'n' drop some files here, or click to select files"})]})]}),e.jsxs(w,{size:4,children:[e.jsx(i,{variant:"overline",color:"secondary",children:"Step 2 - Resize Image"}),r.length>0&&e.jsx(Jn,{ref:t,src:(j=r[0])==null?void 0:j.preview,style:{height:300,width:"100%"},initialAspectRatio:1,aspectRatio:1,guides:!1,viewMode:1,dragMode:"move",cropBoxResizable:!1,preview:".img-preview",background:!1})]}),e.jsx(w,{size:4,children:r.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"overline",color:"secondary",children:"Step 3 - Preview and Upload"}),e.jsx("div",{className:"img-preview",style:{width:300,height:300,overflow:"hidden"}}),e.jsx(C,{variant:"contained",color:"secondary",onClick:d,disabled:s,sx:{width:300,my:1},children:s?"Uploading...":"Upload Image"})]})})]})}function zs({isStarred:n}){return e.jsx(l,{children:e.jsxs(C,{sx:{border:"none",cursor:"pointer",position:"relative",transition:"transform 0.2s"},children:[e.jsx(Sn,{sx:{color:"white",fontSize:28,position:"absolute"}}),e.jsx(Pn,{sx:{color:n?"yellow":"rgba(0, 0, 0, 0.54)",fontSize:28,cursor:"pointer"}})]})})}function Us(){return e.jsx(l,{children:e.jsxs(C,{sx:{border:"none",cursor:"pointer",position:"relative",transition:"transform 0.2s"},children:[e.jsx(In,{sx:{color:"white",fontSize:28,position:"absolute"}}),e.jsx(An,{sx:{color:"red",fontSize:28,cursor:"pointer"}})]})})}function Ns(){const{id:n}=W(),{photos:s,isLoadingPhoto:r,isCurrentUser:o,uploadPhoto:t,profile:a,setMainPhoto:d,deletePhoto:u}=H(n),[f,x]=p.useState(!1),j=h=>{t.mutate(h,{onSuccess:()=>{x(!1)}})};return r?e.jsx(i,{children:"Loading..."}):e.jsxs(l,{children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",mb:2,children:[e.jsx(i,{variant:"h5",children:"Photos"}),o&&e.jsx(C,{variant:"contained",color:"primary",onClick:()=>x(!f),children:f?"Cancel":"Add Photo"})]}),e.jsx(R,{sx:{mb:2}}),f?e.jsx(Rs,{uploadPhoto:j,loading:t.isPending}):e.jsxs(e.Fragment,{children:[(s==null?void 0:s.length)===0&&e.jsx(i,{children:"No photos added yet"}),e.jsx(Dn,{sx:{height:450},cols:6,rowHeight:164,children:(s??[]).map(h=>e.jsxs(Fn,{children:[e.jsx("img",{srcSet:`${h.url.replace("upload","upload/w_164,h_164,dpr_2,g_face,c_fill,f_auto")}`,src:`${h.url.replace("upload","upload/w_164,h_164,dpr_2,g_face,c_fill,f_auto")}`,alt:"user-photo",loading:"lazy"}),o&&e.jsxs("div",{children:[e.jsx(l,{sx:{position:"absolute",top:0,right:0},onClick:()=>d.mutate(h),children:e.jsx(zs,{isStarred:h.url===(a==null?void 0:a.imageUrl)})}),(a==null?void 0:a.imageUrl)!==h.url&&e.jsx(l,{sx:{position:"absolute",top:0,left:0,alignSelf:"flex-start"},onClick:()=>u.mutate(h.id),children:e.jsx(Us,{})})]})]},h.id))})]})]})}const Ts=L.object({displayName:T("displayName"),bio:L.string().optional()});function Ws({setEditMode:n}){const{id:s}=W(),{profile:r,editProfile:o}=H(s),{handleSubmit:t,reset:a,control:d}=_({resolver:Z(Ts),mode:"onTouched"}),[u,f]=p.useState((r==null?void 0:r.displayName)||""),x=m=>{f(m.target.value)},[j,h]=p.useState((r==null?void 0:r.bio)||""),P=m=>{h(m.target.value)};p.useEffect(()=>{r&&a({...r})},[r,a]);const S=m=>{try{if(m){if(!(r!=null&&r.id)){console.error("Profile ID is missing");return}const A={...r,...m,id:r.id};o.mutate(A,{onSuccess:()=>{n(!1)},onError:$=>{console.log($)}})}else console.log("Profile data is not available")}catch(A){console.log(A)}};return e.jsx(F,{children:e.jsxs(l,{component:"form",display:"flex",marginTop:1,gap:2,flexDirection:"column",autoComplete:"off",onSubmit:t(S),children:[e.jsx(E,{label:"Display Name",name:"displayName",value:u,onChange:x,fullWidth:!0,variant:"outlined",control:d}),e.jsx(E,{label:"Bio",value:j,onChange:P,name:"bio",multiline:!0,rows:7,control:d}),e.jsx(l,{sx:{display:"flex",justifyContent:"right",pb:2},justifyContent:"space-between",marginTop:2,children:e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mr:2},children:e.jsx(C,{variant:"contained",color:"primary",type:"submit",disabled:o.isPending||(r==null?void 0:r.displayName)===u&&(r==null?void 0:r.bio)===j,children:"Update Profile"})})})]})})}function Bs(){const{id:n}=W(),[s,r]=p.useState(!1),{profile:o,isCurrentUser:t}=H(n);return e.jsxs(l,{children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",children:[e.jsxs(i,{variant:"h5",children:["About ",o==null?void 0:o.displayName]}),t&&e.jsx(C,{onClick:()=>r(!s),children:s?e.jsx(i,{variant:"button",color:"error",children:"Cancel"}):"Edit"})]}),e.jsx(R,{sx:{my:2}}),e.jsx(l,{sx:{overflow:"auto",maxHeight:350},children:s?e.jsx(Ws,{setEditMode:r}):e.jsx(i,{variant:"body1",sx:{whiteSpace:"pre-wrap"},children:(o==null?void 0:o.bio)||"No description added yet"})})]})}function Ce({activeTab:n}){const{id:s}=W(),r=n===3?"followers":"followings",{profile:o,followings:t,loadingFollowings:a}=H(s,r);return e.jsxs(l,{children:[e.jsx(l,{display:"flex",children:e.jsx(i,{variant:"h5",fontWeight:600,color:"primary.main",children:n===3?`People following ${o==null?void 0:o.displayName}`:`People ${o==null?void 0:o.displayName} is following`})}),e.jsx(R,{sx:{my:2}}),a?e.jsx(i,{children:"Loading..."}):e.jsx(l,{display:"flex",marginTop:3,children:(t??[]).length>0?(t??[]).map(d=>e.jsx(Ue,{profile:d},d.id)):e.jsxs(i,{children:["No ",r," yet!"]})})]})}function le({userActivities:n}){return e.jsx(l,{children:e.jsx(w,{container:!0,spacing:2,sx:{height:400,overflowY:"auto"},children:e.jsx(w,{size:12,spacing:10,display:"flex",direction:"row",sx:{gap:2,p:2},children:n&&n.map(s=>e.jsx(D,{to:`/activities/${s.id}`,style:{textDecoration:"none"},children:e.jsxs(J,{elevation:4,sx:{transition:"transform 0.3s ease-in-out","&:hover":{transform:"scale(1.05)"}},children:[e.jsx(he,{component:"img",src:`/assets/categoryImages/${s.category}.jpg`,alt:`${s.category} image`,height:"100",sx:{objectFit:"cover"}}),e.jsxs(ne,{children:[e.jsx(i,{textAlign:"center",variant:"h6",children:s.title}),e.jsxs(i,{textAlign:"center",variant:"body2",display:"flex",flexDirection:"column",children:[e.jsx("span",{children:ce(s.date,"do LLL yyyy")}),e.jsx("span",{children:ce(s.date,"h:mm a")})]})]})]})},s.id))})})})}function $s(){const{id:n}=W(),{userActivities:s,isLoadingUserActivities:r,setFilter:o}=H(n),[t,a]=p.useState("future"),d=(u,f)=>{a(f),o(f)};return p.useEffect(()=>{o(t)},[t,o]),e.jsx(l,{sx:{width:"100%",typography:"body1"},children:e.jsxs(kn,{value:t,children:[e.jsx(l,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Ln,{onChange:d,"aria-label":"lab API tabs example",children:[e.jsx(ee,{label:"Future Events",value:"future"}),e.jsx(ee,{label:"Past Events",value:"past"}),e.jsx(ee,{label:"Hosting",value:"hosting"})]})}),e.jsx(ie,{value:"future",children:r?e.jsx(i,{children:"Loading..."}):e.jsx(le,{userActivities:s||[]})}),e.jsx(ie,{value:"past",children:r?e.jsx(i,{children:"Loading..."}):e.jsx(le,{userActivities:s||[]})}),e.jsx(ie,{value:"hosting",children:r?e.jsx(i,{children:"Loading..."}):e.jsx(le,{userActivities:s||[]})})]})})}function qs(){const[n,s]=p.useState(0),r=(t,a)=>{s(a)},o=[{label:"About",content:e.jsx(Bs,{})},{label:"Photos",content:e.jsx(Ns,{})},{label:"Events",content:e.jsx($s,{})},{label:"Followers",content:e.jsx(Ce,{activeTab:n})},{label:"Followings",content:e.jsx(Ce,{activeTab:n})}];return e.jsxs(l,{component:F,elevation:3,mt:2,height:500,sx:{display:"flex",alignItems:"flex-start",borderRadius:3},children:[e.jsx(En,{orientation:"vertical",value:n,onChange:r,sx:{borderRight:1,borderColor:"divider",width:200,height:450},children:o.map((t,a)=>e.jsx(ee,{label:t.label,sx:{mr:1}},a))}),e.jsx(l,{sx:{flexGrow:0,padding:3,tp:0,position:"relative",width:"100%"},children:o[n].content})]})}function Ms(){const{id:n}=W(),{profile:s,isLoadingProfile:r}=H(n);return r?e.jsx(i,{children:"Loading..."}):s?e.jsx(w,{children:e.jsxs(w,{direction:"column",container:!0,sx:{marginTop:2},children:[e.jsx(Es,{}),e.jsx(qs,{})]})}):e.jsx(i,{children:"Profile not found"})}function Hs(){const{verifyEmail:n,resendConfirmationEmail:s}=B(),[r,o]=p.useState("verifying"),[t]=Oe(),a=t.get("userId"),d=t.get("code"),u=p.useRef(!1);p.useEffect(()=>{a&&d&&!u.current&&(u.current=!0,n.mutateAsync({userId:a,code:d}).then(()=>o("verified")).catch(()=>o("failed")))},[a,d,n]);const f=()=>{switch(r){case"verifying":return e.jsx(i,{children:"Verifying..."});case"verified":return e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",gap:2,children:[e.jsx(i,{variant:"h3",children:"Verification successful. You can now log in."}),e.jsx(C,{variant:"contained",component:D,to:"/login",children:"Go to Log In"})]});case"failed":return e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",gap:2,children:[e.jsx(i,{children:"Verification failed. You can try resending the verify link to your email."}),e.jsx(C,{onClick:()=>s.mutate({userId:a}),disabled:s.isPending,variant:"contained",children:"Resend Verification Email"})]})}};return e.jsxs(F,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:400,backgroundColor:"#f5f5f5",backgroundImage:"linear-gradient(135deg, #182a73 0%, #218aae 69%, #20a7ac 89%)"},children:[e.jsx(Rn,{sx:{fontSize:100,color:"primary"}}),e.jsx(i,{gutterBottom:!0,variant:"h3",sx:{textAlign:"center"},children:"Email Verification"}),e.jsx(R,{}),e.jsx(i,{gutterBottom:!0,variant:"h3",sx:{textAlign:"center"},children:f()})]})}const Qs=L.object({currentPassword:T("currentPassword"),newPassword:T("newPassword"),confirmPassword:T("confirmPassword")}).refine(n=>n.newPassword===n.confirmPassword,{message:"Passwords do not match",path:["confirmPassword"]});function Os({title:n,icon:s,resolver:r,onSubmit:o,children:t,submitButtonText:a,reset:d}){const u=_({resolver:r,mode:"onTouched"}),f=x=>{o(x),d&&u.reset()};return e.jsx(Mn,{...u,children:e.jsxs(F,{component:"form",onSubmit:u.handleSubmit(f),sx:{display:"flex",flexDirection:"column",p:3,gap:3,maxWidth:"md",mx:"auto",borderRadius:3},children:[e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"center",gap:3,color:"secondary.main",children:[s,e.jsx(i,{variant:"h4",children:n})]}),t,e.jsx(C,{type:"submit",disabled:!u.formState.isValid||u.formState.isSubmitting,variant:"contained",size:"large",children:a})]})})}function Vs(){const{changePassword:n}=B(),s=async r=>{try{await n.mutateAsync(r,{onSuccess:()=>{Q.success("Password changed successfully")}})}catch(o){console.log(o)}};return e.jsxs(Os,{title:"Change Password",icon:e.jsx("i",{className:"fa fa-lock"}),resolver:Z(Qs),onSubmit:s,submitButtonText:"Update Password",reset:!0,children:[e.jsx(E,{name:"currentPassword",label:"Current Password",type:"password"}),e.jsx(E,{name:"newPassword",label:"New Password",type:"password"}),e.jsx(E,{name:"confirmPassword",label:"Confirm Password",type:"password"})]})}const de=Ve([{path:"/",element:e.jsx(rs,{}),children:[{element:e.jsx(Ds,{}),children:[{path:"activities",element:e.jsx(cs,{})},{path:"activities/:id",element:e.jsx(ws,{})},{path:"createActivity",element:e.jsx(we,{},"create")},{path:"manage/:id",element:e.jsx(we,{})},{path:"profiles/:id",element:e.jsx(Ms,{})},{path:"change-password",element:e.jsx(Vs,{})}]},{path:"",element:e.jsx(ze,{})},{path:"counter",element:e.jsx(Cs,{})},{path:"errors",element:e.jsx(vs,{})},{path:"/not-found",element:e.jsx(Ss,{})},{path:"/server-error",element:e.jsx(Ps,{})},{path:"/login",element:e.jsx(As,{})},{path:"/register",element:e.jsx(Ls,{})},{path:"/confirm-email",element:e.jsx(Hs,{})},{path:"*",element:e.jsx(Pe,{replace:!0,to:"/not-found"})}]}]),Ks=new qe;We.createRoot(document.getElementById("root")).render(e.jsx(p.StrictMode,{children:e.jsx(zn,{dateAdapter:Un,children:e.jsx(Re.Provider,{value:U,children:e.jsxs(Me,{client:Ks,children:[e.jsx(He,{}),e.jsx(Be,{position:"bottom-right",autoClose:3e3,hideProgressBar:!0,theme:"colored"}),e.jsx(Ke,{router:de})]})})})}));
