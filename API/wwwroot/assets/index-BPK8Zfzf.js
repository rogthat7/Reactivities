var Be=Object.defineProperty;var $e=(s,n,t)=>n in s?Be(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t;var T=(s,n,t)=>$e(s,typeof n!="symbol"?n+"":n,t);import{j as e,r as g}from"./react-BgDqD0BF.js";import{c as qe}from"./react-dom-B76qEhqe.js";import{y as q,L as He}from"./react-toastify-Cd5VntY5.js";import{u as xe,a as Q,b as F,c as Me,Q as Oe,d as Qe,R as Ge}from"./@tanstack-EF--InMw.js";import{N as Ae,u as V,L as D,a as Z,S as Ve,O as Fe,b as $,c as De,d as he,e as Ke,R as _e}from"./react-router-DrXbiubp.js";import{M as B,B as y,a as l,A as K,b as Ye,L as ee,c as Je,d as M,P as ke,e as Ze,D as N,f as Xe,g as es,C as Le,T as ss,h as i,i as me,j as k,k as X,l as ge,m as ne,n as G,o as ns,p as ts,q as rs,r as Ee,s as os,F as is,t as as,E as ls,G as v,u as pe,v as cs,I as ds,S as us,w as xs,x as hs,y as ms,z as Re,H as gs,J as fe,K as ps,N as fs,O as js,Q as bs,R as ys,U as ws,V as Cs,W as je,X as ze,Y as vs,Z as ve,_ as Ss,$ as Ps,a0 as Is,a1 as As,a2 as Fs,a3 as Ds,a4 as ks,a5 as Ls,a6 as Es,a7 as se,a8 as ae,a9 as Rs,aa as zs,ab as Ns,ac as Us}from"./@mui-B8IgXr-N.js";import{O as Ts,o as te,u as Ws}from"./mobx-react-lite-BTwHq6E8.js";import{a as be,r as Se}from"./mobx-xjmfNSXz.js";import{a as Ne}from"./axios-xsH4HHeE.js";import{z as L}from"./zod-C4bLmoCR.js";import{S as Bs,f as de}from"./date-fns-CJWB21-A.js";import{u as $s}from"./react-intersection-observer-CR7J_zgx.js";import{C as qs}from"./react-calendar-B4wrolSb.js";import{u as Hs,b as re,c as _,F as Ms}from"./react-hook-form-_F_gE8Se.js";import{s as Y}from"./@hookform-DEvFLUYq.js";import{l as Os,m as Qs}from"./leaflet-C5JgwxMT.js";import{M as Gs,T as Vs,a as Ks,P as _s}from"./react-leaflet-B2zthTho.js";import{H as Ys}from"./@microsoft-JXRn2a9-.js";import{u as Js}from"./react-dropzone-BntINOXS.js";import{l as Zs}from"./react-cropper-DzVgjz3L.js";import"./cropperjs-Bq9aDmdf.js";import"./attr-accept-DacPH0-p.js";import"./scheduler-SPyfQU6S.js";import"./clsx-B-dksMZM.js";import"./cookie--_YQFYBD.js";import"./@babel-BtohYyOd.js";import"./prop-types-CyT9pI1Q.js";import"./@emotion-Bb6mt2UZ.js";import"./hoist-non-react-statics-C-Qo8PK8.js";import"./stylis-DDa9OTMq.js";import"./react-transition-group-CPBwl8KG.js";import"./dom-helpers-D0mFdbeO.js";import"./@popperjs-CMBiYTiD.js";import"./react-is-BPJnJB5S.js";import"./use-sync-external-store-CyJQA7jq.js";import"./get-user-locale-dEcy---E.js";import"./mem-682X8IXo.js";import"./mimic-fn-kh_GziL3.js";import"./map-age-cleaner-B1I_vRRc.js";import"./p-defer-BUV9kL4s.js";import"./@wojtekmaj-AYOw5BZR.js";import"./@react-leaflet-3bGK7VMe.js";import"./file-selector-CEwG-fuv.js";import"./tslib-6vuVcGup.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();function J({children:s,to:n}){return e.jsx(B,{component:Ae,to:n,sx:{textDecoration:"none",fontSize:"1.2rem",textTransform:"uppercase",fontWeight:"bold",color:"inherit","&.active":{backgroundColor:"#1e90ff",color:"#ff7f50"},"&:hover":{backgroundColor:"#1e90ff",color:"#1976d2"},border:"none",padding:"10px 20px",borderRadius:"5px",transition:"all 0.3s ease-in-out",cursor:"pointer"},children:s})}class Xs{constructor(){T(this,"count",0);T(this,"title","Counter Store");T(this,"increment",(n=1)=>{this.count+=n});T(this,"decrement",(n=1)=>{this.count-=n});be(this)}}class en{constructor(){T(this,"isLoading",!1);be(this)}isBusy(){this.isLoading=!0}isIdle(){this.isLoading=!1}}class sn{constructor(){T(this,"filter","all");T(this,"startDate",new Date().toISOString());T(this,"setFilter",n=>{this.filter=n});T(this,"setStartDate",n=>{this.startDate=n.toISOString()});be(this)}}const W={counterStore:new Xs,UIStore:new en,activityStore:new sn},Ue=g.createContext(W);function oe(){return g.useContext(Ue)}const C=Ne.create({baseURL:"/api",timeout:1e4,withCredentials:!0});C.interceptors.request.use(s=>(W.UIStore.isBusy(),s));C.interceptors.response.use(async s=>{switch(s.status){case 200:case 201:return W.UIStore.isIdle(),s;case 204:return W.UIStore.isIdle(),Promise.resolve({});default:return Promise.reject(s.data)}},async s=>{var o,r;const n=(o=s.response)==null?void 0:o.status,t=(r=s.response)==null?void 0:r.data;switch(n){case 401:{if(t.detail==="NotAllowed")throw new Error(t.detail);q.error("Unauthorized"),W.UIStore.isIdle();break}case 403:{q.error("Forbidden"),W.UIStore.isIdle();break}case 404:{ue.navigate("/not-found");break}case 400:case 422:if(t!=null&&t.errors){const a=[];for(const d in t.errors)t.errors[d]&&a.push(t.errors[d]);throw W.UIStore.isIdle(),a.flat()}else t&&q.error(t);W.UIStore.isIdle();break;case 500:{ue.navigate("/server-error",{state:{error:t}});break}default:q.error("An unexpected error occurred");break}return W.UIStore.isIdle(),Promise.reject(t)});const U=()=>{const s=xe(),n=V(),{data:t,isLoading:o}=Q({queryKey:["user"],queryFn:async()=>(await C.get("/account/user-info")).data,enabled:!s.getQueryData(["user"])}),r=F({mutationFn:async h=>{await C.post("/login?useCookies=true",h)},onSuccess:async()=>{await s.invalidateQueries({queryKey:["user"]})}}),a=F({mutationFn:async()=>{await C.post("/account/logout")},onSuccess:()=>{s.removeQueries({queryKey:["user"]}),s.removeQueries({queryKey:["activities"]}),n("/")}}),d=F({mutationFn:async h=>{await C.post("/account/register",h)}}),u=F({mutationFn:async({userId:h,code:m})=>{await C.get(`/confirmEmail?userId=${h}&code=${m}`)}}),f=F({mutationFn:async({email:h,userId:m})=>{await C.get("/account/resendConfirmEmail",{params:{email:h,userId:m}})},onSuccess:()=>{q.success("Email sent - Please check your inbox")}}),x=F({mutationFn:async h=>{await C.put("/account/change-password",JSON.stringify({currentPassword:h.currentPassword,newPassword:h.newPassword}),{headers:{"Content-Type":"application/json"}})}}),S=F({mutationFn:async h=>{await C.post("/forgotPassword",{email:h})}}),j=F({mutationFn:async h=>{await C.post("/resetPassword",JSON.stringify(h),{headers:{"Content-Type":"application/json"}})}}),P=F({mutationFn:async h=>(await C.post(`/account/github-login?code=${h}`)).data,onSuccess:async()=>{await s.invalidateQueries({queryKey:["user"]})}});return{loginUser:r,currentUser:t,logoutUser:a,loadingUserInfo:o,registerUser:d,verifyEmail:u,resendConfirmationEmail:f,changePassword:x,forgotPassword:S,resetPassword:j,fetchGithubToken:P}};function nn(){const[s,n]=g.useState(null),t=!!s,o=u=>{n(u.currentTarget)},r=()=>{n(null)},{currentUser:a,logoutUser:d}=U();return e.jsxs(e.Fragment,{children:[e.jsx(y,{onClick:o,color:"inherit",size:"large",sx:{fontSize:"1.1rem"},children:e.jsxs(l,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(K,{src:a==null?void 0:a.imageUrl,alt:"Logged in User"}),a==null?void 0:a.displayName]})}),e.jsxs(Ye,{id:"basic-menu",anchorEl:s,open:t,onClose:r,slotProps:{list:"basic-button"},children:[e.jsxs(B,{component:D,to:"/createActivity",onClick:r,children:[e.jsx(ee,{children:e.jsx(Je,{})}),e.jsx(M,{children:"Create Activity"})]}),e.jsxs(B,{component:D,to:`/profiles/${a==null?void 0:a.id}`,onClick:r,children:[e.jsx(ee,{children:e.jsx(ke,{})}),e.jsx(M,{children:"My Profile"})]}),e.jsxs(B,{component:D,to:"/change-password",onClick:r,children:[e.jsx(ee,{children:e.jsx(Ze,{})}),e.jsx(M,{children:"Change Password"})]}),e.jsx(N,{style:{margin:"0.5rem 0"}}),e.jsxs(B,{onClick:()=>{d.mutate(),r()},children:[e.jsx(ee,{children:e.jsx(Xe,{})}),e.jsx(M,{children:"Logout"})]})]})]})}function tn(){const{currentUser:s}=U(),{UIStore:n}=oe();return e.jsx(l,{sx:{display:"flex"},children:e.jsx(es,{position:"fixed",sx:{backgroundImage:"linear-gradient(135deg, #182a73 0%, #218aae 69%, #20a7ac 89%)"},children:e.jsx(Le,{maxWidth:"lg",sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsxs(ss,{variant:"dense",sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsx(l,{sx:{display:"flex",alignItems:"center",gap:2},children:e.jsxs(B,{component:Ae,to:"/",sx:{display:"flex",alignItems:"center",textTransform:"uppercase",fontSize:"1.2rem",fontWeight:"bold"},children:[e.jsx("img",{src:"/assets/logo.png",alt:"Logo",style:{width:"50px",height:"50px",marginRight:"1rem"}}),e.jsx(i,{variant:"h4",fontWeight:"bold",style:{color:"#fff",position:"relative"},children:"Reactivities"}),e.jsx(Ts,{children:()=>n.isLoading?e.jsx(me,{size:20,thickness:7,sx:{color:"#fff",position:"absolute",top:"30%",left:"105%"},color:"secondary"}):null})]})}),e.jsxs(l,{sx:{display:"flex",gap:2},children:[e.jsx(J,{to:"/activities",children:e.jsx(i,{fontWeight:"bold",style:{color:"#fff"},children:"Activities"})}),e.jsx(J,{to:"/counter",children:e.jsx(i,{fontWeight:"bold",style:{color:"#fff"},children:"Counter"})}),e.jsx(J,{to:"/errors",children:e.jsx(i,{fontWeight:"bold",style:{color:"#fff"},children:"Errors"})})]}),e.jsx(l,{display:"flex",alignItems:"center",children:s?e.jsx(nn,{}):e.jsxs(e.Fragment,{children:[e.jsx(J,{to:"/login",children:e.jsx(i,{fontWeight:"bold",style:{color:"#fff"},children:"Login"})}),e.jsx(J,{to:"/register",children:e.jsx(i,{fontWeight:"bold",style:{color:"#fff"},children:"Register"})})]})})]})})})})}function Te(){return e.jsx(k,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",backgroundColor:"#f5f5f5",gap:6,backgroundImage:"linear-gradient(135deg, #182a73 0%, #218aae 69%, #20a7ac 89%)"},children:e.jsxs(l,{sx:{alignItems:"center",alignContent:"center",color:"#fff"},children:[e.jsx("img",{src:"/assets/logo.png",alt:"Logo",style:{width:"150px",height:"150px",marginBottom:"1rem"}}),e.jsx(i,{variant:"h1",fontWeight:"bold",style:{color:"#fff"},children:"Reactivities"}),e.jsx(i,{variant:"h3",fontWeight:"bold",children:"Welcome to Reactivities"}),e.jsx(y,{variant:"contained",color:"primary",sx:{marginTop:"1rem",backgroundColor:"#fff",color:"#182a73",fontWeight:"bold"},component:D,to:"/activities",children:"Take me to Activities"})]})})}function rn(){const s=Z();return e.jsxs(l,{sx:{display:"flex",flexDirection:"column",height:"100vh",bgcolor:"#f5f5f5"},children:[e.jsx(Ve,{}),s.pathname==="/"?e.jsx(l,{sx:{flexGrow:1,bgcolor:"#f5f5f5"},children:e.jsx(Te,{})}):e.jsxs(e.Fragment,{children:[e.jsx(tn,{}),e.jsx(Le,{maxWidth:"xl",sx:{flexGrow:1,padding:"5rem",bgcolor:"#f5f5f5"},children:e.jsx(Fe,{})})]})]})}function ye(s){return de(s,"dd MMM yyyy h:mm a")}function on(s){return Bs(s)+" ago"}const z=s=>L.string({required_error:`${s} is Required`}).min(3,{message:`${s} is requires minimum 3 characters`});function We({profile:s}){return e.jsx(D,{to:`/profiles/${s.id}`,style:{textDecoration:"none"},children:e.jsxs(X,{elevation:2,sx:{borderRadius:3,p:3,boxShadow:3,textDecoration:"none",maxWidth:200},children:[e.jsx(ge,{component:"img",src:(s==null?void 0:s.imageUrl)||"/assets/user.png",alt:(s==null?void 0:s.displayName)+" image",sx:{width:"100%",zIndex:50}}),e.jsx(ne,{sx:{display:"flex",flexDirection:"column",alignItems:"left",textAlign:"left",fullwidth:"100%",justifyContent:"space-between"},children:e.jsxs(l,{display:"flex",flexDirection:"column",gap:1,sx:{mb:1},children:[e.jsx(i,{variant:"h5",children:s==null?void 0:s.displayName}),s.bio&&e.jsx(i,{variant:"body2",sx:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",maxWidth:250},children:s.bio}),(s==null?void 0:s.isFollowing)&&e.jsx(G,{label:"Following",color:"secondary",variant:"outlined",size:"small",sx:{fontSize:"0.8rem",borderRadius:2}})]})}),e.jsx(N,{sx:{mb:2}}),e.jsxs(l,{display:"flex",gap:2,sx:{alignItems:"center",justifyContent:"start"},children:[e.jsx(ke,{}),e.jsxs(i,{children:[s==null?void 0:s.followersCount," Followers"]})]})]})})}function an({profile:s}){const[n,t]=g.useState(null),o=d=>{t(d.currentTarget)},r=()=>{t(null)},a=!!n;return e.jsxs(e.Fragment,{children:[e.jsx(K,{src:s.imageUrl,alt:s.displayName+" image",component:D,to:`/profiles/${s.id}`,onMouseEnter:o,onMouseLeave:r,sx:{border:s.isFollowing?"2px solid orange":"none",borderColor:"secondary.main"}}),e.jsx(ns,{id:"mouse-over-popover",open:a,anchorEl:n,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},onClose:r,disableRestoreFocus:!0,sx:{cursor:"pointer",marginRight:1,pointerEvents:"none"},children:e.jsx(We,{profile:s})})]})}function ln({activity:s}){const n=s.isHost?"You are hosting":"You are going",t=s.isHost?"secondary":s.isGoing?"warning":"default";return e.jsxs(X,{elevation:2,sx:{borderRadius:3,boxShadow:3,marginBottom:2},children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{padding:1},children:[e.jsx(ts,{avatar:e.jsx(K,{sx:{height:80,width:80},src:s.hostImageUrl,alt:"Host Image"}),title:s.title,subheader:e.jsxs(e.Fragment,{children:["Hosted By"," "," ",e.jsx(D,{to:`/profiles/${s.hostId}`,style:{textDecoration:"none",color:"text.primary"},children:s.hostDisplayName})]})}),e.jsxs(l,{display:"flex",flexDirection:"column",sx:{mr:2,gap:2,backgroundColor:t,borderRadius:1,padding:.5,color:"white",fontSize:"0.8rem",fontWeight:"bold"},children:[(s.isGoing||s.isHost)&&e.jsx(G,{label:n,variant:"outlined",color:t,size:"small",sx:{fontSize:"0.8rem",borderRadius:2}}),s.isCancelled&&e.jsx(G,{label:"Cancelled",color:"error",size:"small",sx:{fontSize:"0.8rem",borderRadius:2}})]})]}),e.jsx(N,{sx:{mb:3}}),e.jsxs(ne,{sx:{padding:0},children:[e.jsxs(l,{display:"flex",alignItems:"center",sx:{mb:2,px:2},children:[e.jsxs(l,{display:"flex",alignItems:"center",gap:0,children:[e.jsx(rs,{sx:{color:"text.primary",mr:1,display:"flex"}}),e.jsx(i,{variant:"body2",color:"text.primary",noWrap:!0,children:s.date?ye(s.date):"Date not available"})]}),e.jsx(Ee,{sx:{ml:3,mr:1}}),e.jsxs(i,{variant:"body2",children:[" ",s.venue]})]}),e.jsx(N,{}),e.jsx(l,{display:"flex",gap:2,sx:{backgroundColor:"grey.200",py:3,pl:3},children:s.attendees.map(o=>e.jsx(an,{profile:o},o.id))}),e.jsx(os,{sx:{display:"flex",ml:1},children:e.jsx(i,{variant:"body2",color:"text.secondary",children:s.description})}),e.jsx(l,{display:"flex",justifyContent:"flex-end",sx:{padding:1},children:e.jsx(y,{component:D,to:`/activities/${s.id}`,variant:"contained",color:"primary",size:"medium",sx:{textTransform:"none",justifySelf:"self-end",borderRadius:3},children:e.jsx(i,{style:{color:"white"},children:"View"})})})]})]})}const ie=s=>{const n=xe(),{currentUser:t}=U(),o=Z(),{activityStore:{filter:r,startDate:a}}=oe(),{data:d,isLoading:u,isFetchingNextPage:f,fetchNextPage:x,hasNextPage:S}=Me({queryKey:["activities",r,a],queryFn:async({pageParam:p=null})=>(await C.get("/activities",{params:{cursor:p,pageSize:3,filter:r,startDate:a}})).data,getNextPageParam:p=>p.nextCursor,getPreviousPageParam:p=>p.nextCursor,initialPageParam:null,enabled:!s&&o.pathname==="/activities"&&!!t,select:p=>({...p,pages:p.pages.map(A=>({...A,items:A.items.map(c=>{const b=c.attendees.find(w=>w.id===c.hostId);return{...c,isHost:(t==null?void 0:t.id)===c.hostId,isGoing:c.attendees.some(w=>w.id===(t==null?void 0:t.id)),hostImageUrl:(b==null?void 0:b.imageUrl)||""}})}))})}),{data:j,isLoading:P}=Q({queryKey:["activities",s],queryFn:async()=>(await C.get(`/activities/${s}`)).data,enabled:!!s&&!!t,select:p=>{const A=p.attendees.find(c=>c.id===p.hostId);return{...p,isHost:(t==null?void 0:t.id)===p.hostId,isGoing:p.attendees.some(c=>c.id===(t==null?void 0:t.id)),hostImageUrl:A==null?void 0:A.imageUrl}}}),h=F({mutationFn:async p=>(await C.post("/activities",p)).data,onSuccess:async()=>{await n.invalidateQueries({queryKey:["activities"]})},onError:p=>{console.error("Error creating activity:",p)}}),m=F({mutationFn:async p=>(await C.put(`/activities/${p.id}`,p)).data,onSuccess:async()=>{await n.invalidateQueries({queryKey:["activities"]})}}),I=F({mutationFn:async p=>(await C.delete(`/activities/${p}`)).data,onSuccess:async()=>{await n.invalidateQueries({queryKey:["activities"]})}}),E=F({mutationFn:async p=>(await C.post(`/activities/${p}/attend`,{})).data,onMutate:async p=>{await n.cancelQueries({queryKey:["activities",p]});const A=n.getQueryData(["activities",p]);return n.setQueryData(["activities",p],c=>{if(!c||!t)return c;const b=t.id===c.hostId,w=c.attendees.some(H=>H.id===t.id);return{...c,isCancelled:b?!c.isCancelled:c.isCancelled,attendees:w?b?c.attendees:c.attendees.filter(H=>H.id!==t.id):[...c.attendees,{id:t.id,displayName:t.displayName,imageUrl:t.imageUrl,username:t.email||"",following:!1,followersCount:0,followingCount:0}]}}),{previousActivity:A}},onError:(p,A,c)=>{console.error("Error updating attendance:",p),c!=null&&c.previousActivity&&n.setQueryData(["activities",A],c==null?void 0:c.previousActivity)}});return{activitiesGroup:d,createActivity:h,updateActivity:m,deleteActivity:I,isLoading:u,isLoadingActivity:P,activity:j,updateAttendance:E,isFetchingNextPage:f,fetchNextPage:x,hasNextPage:S}},cn=te(function(){const{activitiesGroup:n,isLoading:t,hasNextPage:o,fetchNextPage:r}=ie(),{ref:a,inView:d}=$s({threshold:.5});return g.useEffect(()=>{d&&o&&r()},[d,o,r]),n?t?e.jsx(i,{children:"Loading..."}):e.jsx(l,{children:n.pages.map((u,f)=>e.jsx(l,{ref:f===n.pages.length-1?a:null,display:"flex",flexDirection:"column",gap:3,children:u==null?void 0:u.items.map(x=>e.jsx(ln,{activity:{...x,hostImageUrl:x.hostImageUrl??""}},x.id))},f))}):e.jsx(i,{children:"No activities found."})}),dn=te(function(){const{activityStore:{setFilter:n,setStartDate:t,filter:o,startDate:r}}=oe();return e.jsxs(l,{sx:{position:"sticky",top:"7rem",alignSelf:"flex-start",display:"flex",flexDirection:"column",gap:3,borderRadius:3},children:[e.jsx(k,{sx:{padding:3,borderRadius:3,backgroundColor:"#f5f5f5"},children:e.jsxs(l,{sx:{width:"100%"},children:[e.jsxs(i,{variant:"h5",sx:{fontWeight:"bold",mb:1,alignItems:"center",display:"flex",gap:1,color:"primary.main"},children:[e.jsx(is,{sx:{color:"#333",mr:1}}),"Filters"]}),e.jsxs(as,{children:[e.jsx(B,{selected:o==="all",onClick:()=>n("all"),children:e.jsx(M,{primary:"All Events"})}),e.jsx(B,{selected:o==="isGoing",onClick:()=>n("isGoing"),children:e.jsx(M,{primary:"I'm Going"})}),e.jsx(B,{selected:o==="isHost",onClick:()=>n("isHost"),children:e.jsx(M,{primary:"I'm Hosting"})})]})]})}),e.jsxs(l,{component:k,sx:{padding:3,borderRadius:3,width:"100%"},children:[e.jsxs(i,{variant:"h5",sx:{fontWeight:"bold",mb:1,alignItems:"center",display:"flex",gap:1,color:"primary.main"},children:[e.jsx(ls,{sx:{color:"#333",mr:1}}),"Select Date"]}),e.jsx(qs,{value:r||new Date,onChange:a=>t(a)})]})]})});function un(){return e.jsxs(v,{container:!0,spacing:2,sx:{marginTop:"2rem"},children:[e.jsx(v,{size:8,children:e.jsx(cn,{})}),e.jsx(v,{size:4,children:e.jsx(dn,{})})]})}function R({control:s,...n}){var d;const t=Hs(),o=s||(t==null?void 0:t.control);if(!o)throw new Error("TextInput must be used within a FormProvider or passed a control prop");const{field:r,fieldState:a}=re({...n,control:o});return e.jsx(pe,{...n,...r,value:r.value||"",fullWidth:!0,onChange:u=>{r.onChange(u.target.value),n.onChange&&n.onChange(u)},variant:"outlined",error:!!a.error,helperText:(d=a.error)==null?void 0:d.message})}function xn(s){var o;const{field:n,fieldState:t}=re({...s});return e.jsxs(cs,{fullWidth:!0,error:!!t.error,children:[e.jsx(ds,{children:s.label}),e.jsx(us,{value:n.value||"",label:s.label,onChange:n.onChange,children:s.items.map(r=>e.jsx(B,{value:r.value,children:r.text},r.value))}),e.jsx(xs,{children:(o=t.error)==null?void 0:o.message})]})}const hn=[{text:"Drinks",value:"drinks"},{text:"Culture",value:"culture"},{text:"Film",value:"film"},{text:"Food",value:"food"},{text:"Music",value:"music"},{text:"Travel",value:"travel"}];function mn(s){var o;const{field:n,fieldState:t}=re({...s});return e.jsx(hs,{...s,value:n.value?new Date(n.value):null,onChange:r=>{n.onChange(new Date(r))},sx:{width:"100%"},slotProps:{textField:{onBlur:n.onBlur,error:!!t.error,helperText:(o=t.error)==null?void 0:o.message}}})}function gn(s){var h;const{field:n,fieldState:t}=re({...s}),[o,r]=g.useState(!1),[a,d]=g.useState([]),[u,f]=g.useState(n.value||"");g.useEffect(()=>{n.value&&typeof n.value=="object"?f(n.value.venue||""):f(n.value||"")},[n.value]);const x="https://api.locationiq.com/v1/autocomplete?key=e24adf97ff7897&limit=5&dedupe=1&",S=g.useMemo(()=>ms(async m=>{if(!m||m.length<3){d([]);return}r(!0);try{const I=await Ne.get(`${x}q=${m}`);d(I.data)}catch(I){console.log(I),r(!1)}},500),[x]),j=async m=>{n.onChange(m),await S(m)},P=m=>{var c,b,w,H,Ce;const I=((c=m.address)==null?void 0:c.city)||((b=m.address)==null?void 0:b.town)||((w=m.address)==null?void 0:w.village)||((H=m.address)==null?void 0:H.county)||((Ce=m.address)==null?void 0:Ce.state),E=m.display_name,p=m.lat,A=m.lon;f(E),n.onChange({city:I,venue:E,latitude:p,longitude:A}),d([]),r(!1)};return e.jsxs(l,{children:[e.jsx(pe,{...s,value:u,label:"Location",variant:"outlined",fullWidth:!0,onChange:async m=>{j(m.target.value)},helperText:(h=t.error)==null?void 0:h.message,error:!!t.error}),o&&e.jsx(i,{children:"Loading..."}),a.length>0&&e.jsx(Re,{sx:{border:1},children:a.map(m=>e.jsx(gs,{divider:!0,onClick:()=>P(m),children:m.display_name},m.place_id))})]})}const pn=L.object({title:z("Title"),date:L.coerce.date({message:"Date is Required"}),description:z("Description"),category:z("Category"),location:L.object({city:L.string().optional(),venue:z("Venue"),latitude:L.coerce.number(),longitude:L.coerce.number()})});function Pe(){const{id:s}=$(),{updateActivity:n,createActivity:t,activity:o}=ie(s),r=V(),{reset:a,handleSubmit:d,control:u}=_({resolver:Y(pn),mode:"onTouched"});g.useEffect(()=>{o&&a({...o,date:o.date||void 0,location:{city:o.city,venue:o.venue,latitude:o.latitude,longitude:o.longitude}})},[o,a]);const f=x=>{const{location:S,...j}=x,P={...j,...S};try{o?n.mutate({...o,...P},{onSuccess:()=>r(`/activities/${o.id}`)}):t.mutate({...P,location:{...S,city:S.city||""}},{onSuccess:h=>{r(`/activities/${h}`)}})}catch(h){console.log(h)}};return e.jsxs(k,{elevation:3,sx:{borderRadius:3,padding:2,margin:1},children:[e.jsx(i,{variant:"h5",gutterBottom:!0,color:"primary",children:o!=null&&o.id?"Edit Activity":"Create Activity"}),e.jsxs(l,{component:"form",display:"flex",gap:2,flexDirection:"column",autoComplete:"off",onSubmit:d(f),children:[e.jsx(R,{label:"Title",control:u,name:"title"}),e.jsx(R,{label:"Description",name:"description",control:u,multiline:!0,rows:3}),e.jsxs(l,{display:"flex",gap:3,children:[e.jsx(xn,{items:hn,label:"Category",name:"category",control:u}),e.jsx(mn,{label:"Date",control:u,name:"date"})]}),e.jsx(gn,{control:u,label:"Enter the location",name:"location"}),e.jsx(l,{sx:{display:"flex",justifyContent:"right",pb:2},justifyContent:"space-between",marginTop:2,children:e.jsxs(fe,{sx:{display:"flex",gap:2,borderRadius:3},children:[e.jsx(y,{onClick:()=>r(-1),variant:"contained",color:"inherit",children:"Cancel"}),e.jsx(y,{variant:"contained",color:"success",type:"submit",disabled:n.isPending||t.isPending,children:"Submit"})]})})]})]})}const le=ps(y)(({theme:s})=>({"&.Mui-disabled":{backgroundColor:s.palette.grey[600],color:s.palette.common.white}}));function fn({activity:s}){const{updateAttendance:n}=ie(s==null?void 0:s.id);return e.jsxs(X,{sx:{position:"relative",mb:2,backgroundColor:"transparent",overflow:"hidden"},children:[(s==null?void 0:s.isCancelled)&&e.jsx(G,{sx:{position:"absolute",left:40,top:20,zIndex:1e3,borderRadius:1},color:"error",label:"Cancelled"}),e.jsx(ge,{component:"img",height:"300",image:`/assets/categoryImages/${s==null?void 0:s.category}.jpg`,alt:`${s==null?void 0:s.category} image`}),e.jsxs(l,{sx:{position:"absolute",bottom:0,width:"100%",color:"white",padding:2,display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"flex-end",background:"linear-gradient(to top, rgba(0, 0, 0, 1.0), transparent)",boxSizing:"border-box"},children:[e.jsxs(l,{children:[e.jsx(i,{variant:"h4",sx:{fontWeight:"bold"},children:s==null?void 0:s.title}),e.jsx(i,{variant:"subtitle1",children:s!=null&&s.date?ye(s.date):"Date not available"}),e.jsxs(i,{variant:"subtitle2",children:["Hosted by ",e.jsx(D,{to:`/profiles/${s==null?void 0:s.hostId}`,style:{color:"white",fontWeight:"bold"},children:s==null?void 0:s.hostDisplayName})]})]}),e.jsx(l,{sx:{display:"flex",gap:2},children:s!=null&&s.isHost?e.jsxs(e.Fragment,{children:[e.jsx(le,{variant:"contained",color:s!=null&&s.isCancelled?"success":"error",onClick:()=>(s==null?void 0:s.id)&&n.mutate(s.id),disabled:n.isPending||(s==null?void 0:s.isCancelled),children:e.jsx(i,{children:s!=null&&s.isCancelled?"Re-activate Activity":"Cancel Activity"})}),e.jsx(le,{variant:"contained",color:"primary",component:D,to:`/manage/${s==null?void 0:s.id}`,disabled:s==null?void 0:s.isCancelled,children:e.jsx(i,{color:"White",children:"Manage Event"})})]}):e.jsx(le,{variant:"contained",color:s!=null&&s.isGoing?"primary":"info",onClick:()=>(s==null?void 0:s.id)&&n.mutate(s.id),disabled:n.isPending||(s==null?void 0:s.isCancelled),children:s!=null&&s.isGoing?"Cancel Attendance":"Join Activity"})})]})]})}function jn({position:s,venue:n}){return e.jsxs(Gs,{center:s,zoom:13,scrollWheelZoom:!1,style:{height:"100%"},children:[e.jsx(Vs,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(Ks,{position:s,icon:new Os.Icon({iconUrl:Qs,iconSize:[25,41],iconAnchor:[12,41]}),children:e.jsx(_s,{children:n})})]})}function bn({activity:s}){const[n,t]=g.useState(!1);return e.jsxs(k,{sx:{mb:2},children:[e.jsxs(v,{container:!0,alignItems:"center",pl:2,py:1,children:[e.jsx(v,{size:1,children:e.jsx(fs,{color:"info",fontSize:"large"})}),e.jsx(v,{size:11,children:e.jsx(i,{children:s==null?void 0:s.description})})]}),e.jsx(N,{}),e.jsxs(v,{container:!0,alignItems:"center",pl:2,py:1,children:[e.jsx(v,{size:1,children:e.jsx(js,{color:"info",fontSize:"large"})}),e.jsx(v,{size:11,children:e.jsx(i,{children:s!=null&&s.date?ye(s.date):"Date not available"})})]}),e.jsx(N,{}),e.jsxs(v,{container:!0,alignItems:"center",pl:2,py:1,children:[e.jsx(v,{size:1,children:e.jsx(Ee,{color:"info",fontSize:"large"})}),e.jsxs(v,{size:11,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(i,{children:[s==null?void 0:s.venue,", ",s==null?void 0:s.city]}),e.jsx(y,{sx:{whiteSpace:"nowrap",mx:2},onClick:()=>{t(!n)},children:n?"Hide map":"Show map"})]})]}),n&&e.jsx(l,{sx:{height:300,zIndex:1e3,display:"block"},children:e.jsx(jn,{position:[(s==null?void 0:s.latitude)??0,(s==null?void 0:s.longitude)??0],venue:(s==null?void 0:s.venue)||"Unknown venue"})})]})}const yn=s=>{const n=g.useRef(!1),t=Ws(()=>({comments:[],hubConnection:null,setHubConnection(o){o&&(this.hubConnection=new Ys().withUrl(`/comments?activityId=${o}`,{withCredentials:!0}).withAutomaticReconnect().build(),this.hubConnection.start().catch(r=>console.error("Error Establishing Hub Connection: ",r)),this.hubConnection.on("LoadComments",r=>{Se(()=>{this.comments=r})}),this.hubConnection.on("ReceiveComment",r=>{Se(()=>{this.comments.unshift(r)})}))},stopHubConnection(){this.hubConnection&&this.hubConnection.state==="Connected"&&this.hubConnection.stop().catch(o=>console.error("Error Stopping Hub Connection: ",o))}}));return g.useEffect(()=>(s&&!n.current&&(n.current=!0,t.setHubConnection(s)),()=>{t.stopHubConnection(),t.comments=[]}),[s]),{commentStore:t}},wn=te(function(){const{id:n}=$(),{commentStore:t}=yn(n),{register:o,handleSubmit:r,reset:a,formState:{isSubmitting:d}}=_(),u=async x=>{var S;try{await((S=t.hubConnection)==null?void 0:S.invoke("SendComment",{activityId:n,body:x.body})),a()}catch(j){console.log(j)}},f=x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),r(u)())};return e.jsxs(e.Fragment,{children:[e.jsx(l,{sx:{textAlign:"center",bgcolor:"primary.main",color:"white",padding:2},children:e.jsx(i,{variant:"h6",children:"Chat about this event"})}),e.jsx(X,{children:e.jsxs(ne,{children:[e.jsx("div",{children:e.jsx("form",{children:e.jsx(pe,{...o("body",{required:!0}),onKeyDown:f,variant:"outlined",fullWidth:!0,multiline:!0,rows:2,placeholder:"Enter your comment (Enter to submit, SHIFT + Enter for new line)",slotProps:{input:{endAdornment:d?e.jsx(me,{size:24}):null}}})})}),e.jsx(l,{sx:{height:400,overflowY:"auto",mt:1},children:t.comments.map(x=>e.jsxs(l,{sx:{display:"flex",my:2},children:[e.jsx(K,{src:x.imageUrl,alt:"user image",sx:{mr:2}}),e.jsxs(l,{display:"flex",flexDirection:"column",children:[e.jsxs(l,{display:"flex",alignItems:"center",gap:3,children:[e.jsx(i,{component:D,to:`/profiles/${x.userId}`,variant:"subtitle1",sx:{fontWeight:"bold",textDecoration:"none"},children:x.displayName}),e.jsx(i,{variant:"body2",color:"textSecondary",children:on(x.createdAt)})]}),e.jsx(i,{sx:{whiteSpace:"pre-wrap"},children:x.body})]})]},x.id))})]})})]})});function Cn({activity:s}){return e.jsxs(e.Fragment,{children:[e.jsx(k,{sx:{textAlign:"center",border:"none",backgroundColor:"primary.main",color:"white",p:2},children:e.jsxs(i,{variant:"h6",children:[s==null?void 0:s.attendees.length," ",(s==null?void 0:s.attendees.length)===1?"Person":"People"," Going"]})}),e.jsx(k,{sx:{padding:2},children:s==null?void 0:s.attendees.map(n=>e.jsxs(v,{container:!0,alignItems:"center",children:[e.jsx(v,{size:8,children:e.jsx(Re,{sx:{display:"flex",flexDirection:"column"},children:e.jsxs(bs,{component:D,to:`/profiles/${n.id}`,children:[e.jsx(ys,{children:e.jsx(K,{variant:"rounded",sx:{width:75,height:75,mr:3},alt:n.displayName,src:n.imageUrl})}),e.jsxs(M,{children:[e.jsx(i,{variant:"h6",children:n.displayName}),(n==null?void 0:n.isFollowing)&&e.jsx(i,{variant:"body2",color:"orange",children:"Following"})]})]})})}),e.jsx(v,{size:4,sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1},children:(s==null?void 0:s.hostId)===n.id&&e.jsx(G,{label:"Host",color:"warning",variant:"filled",sx:{borderRadius:2}})})]},n.id))})]})}function vn(){const{id:s}=$(),{activity:n,isLoadingActivity:t}=ie(s);return t?e.jsx(i,{variant:"h5",color:"primary",children:"Loading..."}):n?e.jsxs(v,{container:!0,spacing:3,children:[e.jsxs(v,{size:8,children:[e.jsx(fn,{activity:n}),e.jsx(bn,{activity:n}),e.jsx(wn,{})]}),e.jsx(v,{size:4,children:e.jsx(Cn,{activity:n})})]}):e.jsx(i,{variant:"h5",color:"error",children:"Activity not found"})}const Sn=te(function(){const{counterStore:n}=oe(),{count:t,title:o}=n;return console.log("Counter component rendered",t,o),e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"h4",color:"primary",gutterBottom:!0,children:o}),e.jsxs(i,{variant:"h6",color:"secondary",gutterBottom:!0,children:["Count: ",n.count]}),e.jsxs(fe,{variant:"contained",color:"primary","aria-label":"outlined primary button group",sx:{mt:2,p:2,gap:2},children:[e.jsx(y,{color:"primary",variant:"contained",onClick:()=>n.increment(1),children:"Increment"}),e.jsx(y,{color:"secondary",variant:"contained",onClick:()=>n.decrement(1),children:"Decrement"})]})]})});function Pn(){const[s,n]=g.useState([]),{mutate:t}=F({mutationFn:async({path:r,method:a="get"})=>{a==="post"?await C.post(r,{}):await C.get(r)},onError:r=>{Array.isArray(r)?n(r):n([])}}),o=(r,a="get")=>{t({path:r,method:a})};return e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"h4",children:"Test errors component"}),e.jsxs(fe,{variant:"contained",sx:{mt:4},children:[e.jsx(y,{onClick:()=>o("buggy/not-found"),children:"Not found"}),e.jsx(y,{onClick:()=>o("buggy/bad-request"),children:"Bad request"}),e.jsx(y,{onClick:()=>o("activities","post"),children:"Validation error"}),e.jsx(y,{onClick:()=>o("buggy/server-error"),children:"Server error"}),e.jsx(y,{onClick:()=>o("buggy/unauthorised"),children:"Unauthorised"})]}),s.map((r,a)=>e.jsx(ws,{color:"error",severity:"error",children:r},a))]})}function In(){return e.jsxs(k,{elevation:3,sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:400},children:[e.jsx(Cs,{sx:{fontSize:100,color:"primary"}}),e.jsx(i,{variant:"h3",sx:{mt:2},children:"We couldn't find what you are looking for."}),e.jsx(y,{variant:"contained",sx:{mt:2},component:D,to:"/activities",children:e.jsx(i,{color:"white",children:"Go back to activities"})})]})}function An(){const{state:s}=Z();return e.jsx(k,{children:s!=null&&s.error?e.jsxs(e.Fragment,{children:[e.jsx(i,{color:"error",gutterBottom:!0,variant:"h3",sx:{px:4,pt:2},children:s.error.message||"Internal Server error"}),e.jsx(N,{}),e.jsx(i,{gutterBottom:!0,variant:"body1",sx:{px:4},children:s.error.detail||"Internal Server error"})]}):e.jsx(i,{gutterBottom:!0,variant:"h3",sx:{px:4,pt:2},children:"Server error"})})}const Fn=L.object({email:L.string().email(),password:L.string().min(6)});function Dn(){const[s,n]=g.useState(!1),{loginUser:t,resendConfirmationEmail:o}=U(),r=V(),a=Z(),{control:d,watch:u,handleSubmit:f,formState:{isValid:x,isSubmitting:S}}=_({mode:"onTouched",resolver:Y(Fn)}),j=u("email"),P=async()=>{await o.mutateAsync({email:j}).then(()=>{alert("Confirmation email sent")}).catch(I=>console.log(I)).finally(()=>n(!1))},h=async I=>{await t.mutateAsync(I,{onSuccess:()=>{var E;r(((E=a.state)==null?void 0:E.from)||"/activities")},onError:E=>{E.message==="NotAllowed"&&n(!0)}})},m=async()=>{const I="Ov23lifEKksny9L28Oky",E="https://reactivities-c9b4bjbbcwfxame9.canadacentral-01.azurewebsites.net/auth-callback";window.location.href=`https://github.com/login/oauth/authorize?client_id=${I}&redirect_uri=${E}&scope=read:user%20user:email`};return e.jsxs(k,{component:"form",onSubmit:f(h),sx:{display:"flex",flexDirection:"column",p:3,gap:3,maxWidth:"md",mx:"auto",borderRadius:3},children:[e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"center",gap:3,color:"secondary.main",children:[e.jsx(je,{fontSize:"large"}),e.jsx(i,{variant:"h4",children:"Sign in "})]}),e.jsx(R,{label:"Email",control:d,name:"email"}),e.jsx(R,{type:"password",label:"Password",control:d,name:"password"}),e.jsx(y,{type:"submit",disabled:!x||S,variant:"contained",size:"large",children:"Login"}),e.jsx(y,{onClick:m,variant:"contained",size:"large",startIcon:e.jsx(ze,{}),sx:{backgroundColor:"black"},children:"Login with GitHub"}),s?e.jsxs(l,{sx:{display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:[e.jsx(i,{textAlign:"center",color:"error",children:"Your email is not verified. Please check your inbox. Please click the button below to resend the verification email."}),e.jsx(y,{disabled:o.isPending,onClick:P,children:"Resend Verification Email"})]}):e.jsxs(l,{display:"flex",justifyContent:"center",gap:3,alignItems:"center",children:[e.jsxs(i,{children:[" Forgot Password? Click ",e.jsx(D,{to:"/forgot-password",children:"here"})," "]}),e.jsxs(i,{sx:{textAlign:"center"},children:["Don't have an account?",e.jsx(i,{component:D,to:"/register",color:"primary",sx:{ml:2},children:"Sign up"})]})]})]})}function kn(){const{currentUser:s,loadingUserInfo:n}=U(),t=Z();return n?e.jsx(i,{children:"Loading..."}):s?e.jsx(Fe,{}):e.jsx(De,{to:"/login",state:{from:t}})}const Ln=L.object({email:L.string().email(),displayName:z("displayName"),password:z("password")});function En({email:s}){const{resendConfirmationEmail:n}=U();return s?e.jsxs(k,{elevation:3,sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:400,p:6},children:[e.jsx(vs,{sx:{fontSize:100,color:"primary"}}),e.jsxs(i,{gutterBottom:!0,variant:"h3",sx:{mt:2,textAlign:"center"},children:["A confirmation email has been sent to ",s,". Please check your inbox."]}),e.jsx(y,{variant:"contained",sx:{mt:2},onClick:()=>n.mutate({email:s}),children:"Resend Confirmation Email"})]}):null}function Rn(){const{registerUser:s}=U(),[n,t]=g.useState(!1),{control:o,handleSubmit:r,setError:a,watch:d,formState:{isValid:u,isSubmitting:f}}=_({mode:"onTouched",resolver:Y(Ln)}),x=d("email"),S=async j=>{await s.mutateAsync(j,{onError(P){Array.isArray(P)&&P.forEach(h=>{h.includes("Email")?a("email",{message:h}):h.includes("Password")&&a("password",{message:h})})},onSuccess:()=>{t(!0)}})};return e.jsx(e.Fragment,{children:n?e.jsx(En,{email:x}):e.jsxs(k,{component:"form",onSubmit:r(S),sx:{display:"flex",flexDirection:"column",p:3,gap:3,maxWidth:"md",mx:"auto",borderRadius:3},children:[e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"center",gap:3,color:"secondary.main",children:[e.jsx(je,{fontSize:"large"}),e.jsx(i,{variant:"h4",children:"Register"})]}),e.jsx(R,{label:"Email",control:o,name:"email"}),e.jsx(R,{label:"Display Name",control:o,name:"displayName"}),e.jsx(R,{type:"password",label:"Password",control:o,name:"password"}),e.jsx(y,{type:"submit",disabled:!u||f,variant:"contained",size:"large",children:"Register"}),e.jsxs(i,{sx:{textAlign:"center"},children:["Already have an account?",e.jsx(i,{component:D,to:"/login",color:"primary",sx:{ml:2},children:"Sign in"})]})]})})}const O=(s,n)=>{const[t,o]=g.useState(null),r=xe(),{data:a,isLoading:d}=Q({queryKey:["profile",s],queryFn:async()=>(await C.get(`/profiles/${s}`)).data,enabled:!!s&&!n}),{data:u,isLoading:f}=Q({queryKey:["photos",s],queryFn:async()=>(await C.get(`/profiles/${s}/photos`)).data,enabled:!!s}),x=F({mutationFn:async()=>{await C.post(`/profiles/${s}/follow`)},onSuccess:async()=>{r.setQueryData(["profile",s],c=>(r.invalidateQueries({queryKey:["followings",s,"followers"]}),!c||c.followersCount===void 0?c:{...c,isFollowing:!c.isFollowing,followersCount:c.isFollowing?c.followersCount-1:c.followersCount+1}))}}),S=g.useMemo(()=>{var c;return s===((c=r.getQueryData(["user"]))==null?void 0:c.id)},[s,r]),{data:j,isLoading:P}=Q({queryKey:["followings",s,n],queryFn:async()=>(await C.get(`/profiles/${s}/follow-list/?predicate=${n}`)).data,enabled:!!s&&!!n}),{data:h,isLoading:m}=Q({queryKey:["user-activities",s,t],queryFn:async()=>(await C.get(`/profiles/${s}/activities`,{params:{filter:t}})).data,enabled:!!s&&!!t}),I=F({mutationFn:async c=>{const b=new FormData;return b.append("file",c),(await C.post("/profiles/add-photo",b,{headers:{"Content-Type":"multipart/form-data"}})).data},onSuccess:async c=>{await r.invalidateQueries({queryKey:["photos",s]}),r.setQueryData(["user"],b=>b&&{...b,imageUrl:b.imageUrl??c.url}),r.setQueryData(["profile",s],b=>b&&{...b,imageUrl:b.imageUrl??c.url})}}),E=F({mutationFn:async c=>{await C.put(`/profiles/${c.id}/set-main-photo`)},onSuccess:async(c,b)=>{await r.invalidateQueries({queryKey:["photos",b.id]}),r.setQueryData(["user"],w=>w&&{...w,imageUrl:b.url}),r.setQueryData(["profile",s],w=>w&&{...w,imageUrl:b.url})}}),p=F({mutationFn:async c=>{await C.delete(`/profiles/${c}/photos`)},onSuccess:async(c,b)=>{r.setQueryData(["photos",s],w=>w==null?void 0:w.filter(H=>H.id!==b))}}),A=F({mutationFn:async c=>{await C.put(`/profiles/${c.id}/edit-profile`,c)},onSuccess:async(c,b)=>{r.setQueryData(["profile",s],w=>w&&{...w,displayName:b.displayName,bio:b.bio}),r.setQueryData(["user"],w=>w&&{...w,displayName:b.displayName})}});return{profile:a,isLoadingProfile:d,photos:u,isLoadingPhoto:f,isCurrentUser:S,uploadPhoto:I,setMainPhoto:E,deletePhoto:p,editProfile:A,updateFollowing:x,followings:j,loadingFollowings:P,userActivities:h,isLoadingUserActivities:m,setFilter:o}};function zn(){const{id:s}=$(),{profile:n,isCurrentUser:t,updateFollowing:o}=O(s);return n?e.jsx(k,{elevation:4,sx:{padding:2,borderRadius:3},children:e.jsxs(v,{container:!0,alignItems:"center",children:[e.jsx(v,{size:8,children:e.jsxs(ve,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(K,{sx:{width:150,height:150},src:n.imageUrl||"/assets/user.png",alt:n.displayName+" image"}),e.jsxs(l,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(i,{variant:"h4",fontWeight:700,children:n.displayName}),n.isFollowing&&e.jsx(G,{variant:"outlined",label:"Following",color:"secondary",sx:{borderRadius:1}})]})]})}),e.jsx(v,{size:4,children:e.jsxs(ve,{spacing:2,alignItems:"center",children:[e.jsxs(l,{display:"flex",flexDirection:"row",gap:2,width:"100%",justifyContent:"space-around",children:[e.jsxs(l,{textAlign:"center",children:[e.jsx(i,{variant:"h6",fontWeight:700,children:"Followers"}),e.jsx(i,{variant:"h3",fontWeight:700,children:n.followersCount})]}),e.jsxs(l,{textAlign:"center",children:[e.jsx(i,{variant:"h6",fontWeight:700,children:"Following"}),e.jsx(i,{variant:"h3",fontWeight:700,children:n.followingsCount})]})]}),!t&&e.jsxs(e.Fragment,{children:[e.jsx(N,{sx:{width:"100%"}}),e.jsx(y,{onClick:()=>o.mutate(),variant:"outlined",color:n.isFollowing?"error":"primary",fullWidth:!0,children:n.isFollowing?"Unfollow":"Follow"})]})]})})]})}):e.jsx(i,{children:"Profile not found"})}function Nn({uploadPhoto:s,loading:n}){var S;const[t,o]=g.useState([]),r=g.useRef(null);g.useEffect(()=>{if(t.length>0)return()=>{t.forEach(j=>URL.revokeObjectURL(j.preview))}},[t]);const a=g.useCallback(j=>{o(j.map(P=>Object.assign(P,{preview:URL.createObjectURL(P)})))},[]),d=g.useCallback(()=>{var P;const j=(P=r.current)==null?void 0:P.cropper;j&&j.getCroppedCanvas().toBlob(h=>{h&&s(h)},"image/jpeg",.8)},[s]),{getRootProps:u,getInputProps:f,isDragActive:x}=Js({onDrop:a});return e.jsxs(v,{container:!0,spacing:5,children:[e.jsxs(v,{size:4,children:[e.jsx(i,{variant:"overline",color:"secondary",children:"Step 1 - Add Photo"}),e.jsxs(l,{...u(),sx:{border:"2px dashed grey",borderRadius:2,padding:2,textAlign:"center",cursor:"pointer",height:"280px",backgroundColor:x?"lightblue":"white","&:hover":{backgroundColor:x?"lightblue":"#f0f0f0"}},children:[e.jsx("input",{...f()}),e.jsx(Ss,{fontSize:"large",color:"action"}),e.jsxs(i,{variant:"h5",color:"textSecondary",children:[" ","Drop Image Here"]}),x?e.jsx("p",{children:"Drop the files here ..."}):e.jsx("p",{children:"Drag 'n' drop some files here, or click to select files"})]})]}),e.jsxs(v,{size:4,children:[e.jsx(i,{variant:"overline",color:"secondary",children:"Step 2 - Resize Image"}),t.length>0&&e.jsx(Zs,{ref:r,src:(S=t[0])==null?void 0:S.preview,style:{height:300,width:"100%"},initialAspectRatio:1,aspectRatio:1,guides:!1,viewMode:1,dragMode:"move",cropBoxResizable:!1,preview:".img-preview",background:!1})]}),e.jsx(v,{size:4,children:t.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"overline",color:"secondary",children:"Step 3 - Preview and Upload"}),e.jsx("div",{className:"img-preview",style:{width:300,height:300,overflow:"hidden"}}),e.jsx(y,{variant:"contained",color:"secondary",onClick:d,disabled:n,sx:{width:300,my:1},children:n?"Uploading...":"Upload Image"})]})})]})}function Un({isStarred:s}){return e.jsx(l,{children:e.jsxs(y,{sx:{border:"none",cursor:"pointer",position:"relative",transition:"transform 0.2s"},children:[e.jsx(Ps,{sx:{color:"white",fontSize:28,position:"absolute"}}),e.jsx(Is,{sx:{color:s?"yellow":"rgba(0, 0, 0, 0.54)",fontSize:28,cursor:"pointer"}})]})})}function Tn(){return e.jsx(l,{children:e.jsxs(y,{sx:{border:"none",cursor:"pointer",position:"relative",transition:"transform 0.2s"},children:[e.jsx(As,{sx:{color:"white",fontSize:28,position:"absolute"}}),e.jsx(Fs,{sx:{color:"red",fontSize:28,cursor:"pointer"}})]})})}function Wn(){const{id:s}=$(),{photos:n,isLoadingPhoto:t,isCurrentUser:o,uploadPhoto:r,profile:a,setMainPhoto:d,deletePhoto:u}=O(s),[f,x]=g.useState(!1),S=j=>{r.mutate(j,{onSuccess:()=>{x(!1)}})};return t?e.jsx(i,{children:"Loading..."}):e.jsxs(l,{children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",mb:2,children:[e.jsx(i,{variant:"h5",children:"Photos"}),o&&e.jsx(y,{variant:"contained",color:"primary",onClick:()=>x(!f),children:f?"Cancel":"Add Photo"})]}),e.jsx(N,{sx:{mb:2}}),f?e.jsx(Nn,{uploadPhoto:S,loading:r.isPending}):e.jsxs(e.Fragment,{children:[(n==null?void 0:n.length)===0&&e.jsx(i,{children:"No photos added yet"}),e.jsx(Ds,{sx:{height:450},cols:6,rowHeight:164,children:(n??[]).map(j=>e.jsxs(ks,{children:[e.jsx("img",{srcSet:`${j.url.replace("upload","upload/w_164,h_164,dpr_2,g_face,c_fill,f_auto")}`,src:`${j.url.replace("upload","upload/w_164,h_164,dpr_2,g_face,c_fill,f_auto")}`,alt:"user-photo",loading:"lazy"}),o&&e.jsxs("div",{children:[e.jsx(l,{sx:{position:"absolute",top:0,right:0},onClick:()=>d.mutate(j),children:e.jsx(Un,{isStarred:j.url===(a==null?void 0:a.imageUrl)})}),(a==null?void 0:a.imageUrl)!==j.url&&e.jsx(l,{sx:{position:"absolute",top:0,left:0,alignSelf:"flex-start"},onClick:()=>u.mutate(j.id),children:e.jsx(Tn,{})})]})]},j.id))})]})]})}const Bn=L.object({displayName:z("displayName"),bio:L.string().optional()});function $n({setEditMode:s}){const{id:n}=$(),{profile:t,editProfile:o}=O(n),{handleSubmit:r,reset:a,control:d}=_({resolver:Y(Bn),mode:"onTouched"}),[u,f]=g.useState((t==null?void 0:t.displayName)||""),x=m=>{f(m.target.value)},[S,j]=g.useState((t==null?void 0:t.bio)||""),P=m=>{j(m.target.value)};g.useEffect(()=>{t&&a({...t,bio:t.bio??void 0})},[t,a]);const h=m=>{try{if(m){if(!(t!=null&&t.id)){console.error("Profile ID is missing");return}const I={...t,...m,id:t.id};o.mutate(I,{onSuccess:()=>{s(!1)},onError:E=>{console.log(E)}})}else console.log("Profile data is not available")}catch(I){console.log(I)}};return e.jsx(k,{children:e.jsxs(l,{component:"form",display:"flex",marginTop:1,gap:2,flexDirection:"column",autoComplete:"off",onSubmit:r(h),children:[e.jsx(R,{label:"Display Name",name:"displayName",value:u,onChange:x,fullWidth:!0,variant:"outlined",control:d}),e.jsx(R,{label:"Bio",value:S,onChange:P,name:"bio",multiline:!0,rows:7,control:d}),e.jsx(l,{sx:{display:"flex",justifyContent:"right",pb:2},justifyContent:"space-between",marginTop:2,children:e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mr:2},children:e.jsx(y,{variant:"contained",color:"primary",type:"submit",disabled:o.isPending||(t==null?void 0:t.displayName)===u&&(t==null?void 0:t.bio)===S,children:"Update Profile"})})})]})})}function qn(){const{id:s}=$(),[n,t]=g.useState(!1),{profile:o,isCurrentUser:r}=O(s);return e.jsxs(l,{children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",children:[e.jsxs(i,{variant:"h5",children:["About ",o==null?void 0:o.displayName]}),r&&e.jsx(y,{onClick:()=>t(!n),children:n?e.jsx(i,{variant:"button",color:"error",children:"Cancel"}):"Edit"})]}),e.jsx(N,{sx:{my:2}}),e.jsx(l,{sx:{overflow:"auto",maxHeight:350},children:n?e.jsx($n,{setEditMode:t}):e.jsx(i,{variant:"body1",sx:{whiteSpace:"pre-wrap"},children:(o==null?void 0:o.bio)||"No description added yet"})})]})}function Ie({activeTab:s}){const{id:n}=$(),t=s===3?"followers":"followings",{profile:o,followings:r,loadingFollowings:a}=O(n,t);return e.jsxs(l,{children:[e.jsx(l,{display:"flex",children:e.jsx(i,{variant:"h5",fontWeight:600,color:"primary.main",children:s===3?`People following ${o==null?void 0:o.displayName}`:`People ${o==null?void 0:o.displayName} is following`})}),e.jsx(N,{sx:{my:2}}),a?e.jsx(i,{children:"Loading..."}):e.jsx(l,{display:"flex",marginTop:3,children:(r??[]).length>0?(r??[]).map(d=>e.jsx(We,{profile:d},d.id)):e.jsxs(i,{children:["No ",t," yet!"]})})]})}function ce({userActivities:s}){return e.jsx(l,{children:e.jsx(v,{container:!0,spacing:2,sx:{height:400,overflowY:"auto"},children:e.jsx(v,{size:12,spacing:10,display:"flex",direction:"row",sx:{gap:2,p:2},children:s&&s.map(n=>e.jsx(D,{to:`/activities/${n.id}`,style:{textDecoration:"none"},children:e.jsxs(X,{elevation:4,sx:{transition:"transform 0.3s ease-in-out","&:hover":{transform:"scale(1.05)"}},children:[e.jsx(ge,{component:"img",src:`/assets/categoryImages/${n.category}.jpg`,alt:`${n.category} image`,height:"100",sx:{objectFit:"cover"}}),e.jsxs(ne,{children:[e.jsx(i,{textAlign:"center",variant:"h6",children:n.title}),e.jsxs(i,{textAlign:"center",variant:"body2",display:"flex",flexDirection:"column",children:[e.jsx("span",{children:de(n.date,"do LLL yyyy")}),e.jsx("span",{children:de(n.date,"h:mm a")})]})]})]})},n.id))})})})}function Hn(){const{id:s}=$(),{userActivities:n,isLoadingUserActivities:t,setFilter:o}=O(s),[r,a]=g.useState("future"),d=(u,f)=>{a(f),o(f)};return g.useEffect(()=>{o(r)},[r,o]),e.jsx(l,{sx:{width:"100%",typography:"body1"},children:e.jsxs(Ls,{value:r,children:[e.jsx(l,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Es,{onChange:d,"aria-label":"lab API tabs example",children:[e.jsx(se,{label:"Future Events",value:"future"}),e.jsx(se,{label:"Past Events",value:"past"}),e.jsx(se,{label:"Hosting",value:"hosting"})]})}),e.jsx(ae,{value:"future",children:t?e.jsx(i,{children:"Loading..."}):e.jsx(ce,{userActivities:n||[]})}),e.jsx(ae,{value:"past",children:t?e.jsx(i,{children:"Loading..."}):e.jsx(ce,{userActivities:n||[]})}),e.jsx(ae,{value:"hosting",children:t?e.jsx(i,{children:"Loading..."}):e.jsx(ce,{userActivities:n||[]})})]})})}function Mn(){const[s,n]=g.useState(0),t=(r,a)=>{n(a)},o=[{label:"About",content:e.jsx(qn,{})},{label:"Photos",content:e.jsx(Wn,{})},{label:"Events",content:e.jsx(Hn,{})},{label:"Followers",content:e.jsx(Ie,{activeTab:s})},{label:"Followings",content:e.jsx(Ie,{activeTab:s})}];return e.jsxs(l,{component:k,elevation:3,mt:2,height:500,sx:{display:"flex",alignItems:"flex-start",borderRadius:3},children:[e.jsx(Rs,{orientation:"vertical",value:s,onChange:t,sx:{borderRight:1,borderColor:"divider",width:200,height:450},children:o.map((r,a)=>e.jsx(se,{label:r.label,sx:{mr:1}},a))}),e.jsx(l,{sx:{flexGrow:0,padding:3,tp:0,position:"relative",width:"100%"},children:o[s].content})]})}function On(){const{id:s}=$(),{profile:n,isLoadingProfile:t}=O(s);return t?e.jsx(i,{children:"Loading..."}):n?e.jsx(v,{children:e.jsxs(v,{direction:"column",container:!0,sx:{marginTop:2},children:[e.jsx(zn,{}),e.jsx(Mn,{})]})}):e.jsx(i,{children:"Profile not found"})}function Qn(){const{verifyEmail:s,resendConfirmationEmail:n}=U(),[t,o]=g.useState("verifying"),[r]=he(),a=r.get("userId"),d=r.get("code"),u=g.useRef(!1);g.useEffect(()=>{a&&d&&!u.current&&(u.current=!0,s.mutateAsync({userId:a,code:d}).then(()=>o("verified")).catch(()=>o("failed")))},[a,d,s]);const f=()=>{switch(t){case"verifying":return e.jsx(i,{children:"Verifying..."});case"verified":return e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",gap:2,children:[e.jsx(i,{variant:"h3",children:"Verification successful. You can now log in."}),e.jsx(y,{variant:"contained",component:D,to:"/login",children:"Go to Log In"})]});case"failed":return e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",gap:2,children:[e.jsx(i,{children:"Verification failed. You can try resending the verify link to your email."}),e.jsx(y,{onClick:()=>n.mutate({userId:a}),disabled:n.isPending,variant:"contained",children:"Resend Verification Email"})]})}};return e.jsxs(k,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:400,backgroundColor:"#f5f5f5",backgroundImage:"linear-gradient(135deg, #182a73 0%, #218aae 69%, #20a7ac 89%)"},children:[e.jsx(zs,{sx:{fontSize:100,color:"primary"}}),e.jsx(i,{gutterBottom:!0,variant:"h3",sx:{textAlign:"center"},children:"Email Verification"}),e.jsx(N,{}),e.jsx(i,{gutterBottom:!0,variant:"h3",sx:{textAlign:"center"},children:f()})]})}const Gn=L.object({currentPassword:z("currentPassword"),newPassword:z("newPassword"),confirmPassword:z("confirmPassword")}).refine(s=>s.newPassword===s.confirmPassword,{message:"Passwords do not match",path:["confirmPassword"]});function we({title:s,icon:n,resolver:t,onSubmit:o,children:r,submitButtonText:a,reset:d}){const u=_({resolver:t,mode:"onTouched"}),f=async x=>{await o(x),d&&u.reset()};return e.jsx(Ms,{...u,children:e.jsxs(k,{component:"form",onSubmit:u.handleSubmit(f),sx:{display:"flex",flexDirection:"column",p:3,gap:3,maxWidth:"md",mx:"auto",borderRadius:3},children:[e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"center",gap:3,color:"secondary.main",children:[n,e.jsx(i,{variant:"h4",children:s})]}),r,e.jsx(y,{type:"submit",disabled:!u.formState.isValid||u.formState.isSubmitting,variant:"contained",size:"large",children:a})]})})}function Vn(){const{changePassword:s}=U(),n=async t=>{try{await s.mutateAsync(t,{onSuccess:()=>{q.success("Password changed successfully")},onError(o){Array.isArray(o)&&o.forEach(r=>{r.includes("Password")&&q.error(r)})}})}catch(o){console.log(o)}};return e.jsxs(we,{title:"Change Password",icon:e.jsx("i",{className:"fa fa-lock"}),resolver:Y(Gn),onSubmit:n,submitButtonText:"Update Password",reset:!0,children:[e.jsx(R,{name:"currentPassword",label:"Current Password",type:"password"}),e.jsx(R,{name:"newPassword",label:"New Password",type:"password"}),e.jsx(R,{name:"confirmPassword",label:"Confirm Password",type:"password"})]})}function Kn(){const{forgotPassword:s}=U(),n=V(),t=async o=>{try{await s.mutateAsync(o.email,{onSuccess:()=>{q.success("Email sent - Please check your inbox"),n("/login")}})}catch(r){console.log(r)}};return e.jsx(we,{title:"Please enter your email address",icon:e.jsx("i",{className:"fa fa-email"}),onSubmit:t,submitButtonText:"Send Email",reset:!0,children:e.jsx(R,{rules:{required:!0},name:"email",label:"Email Address",type:"email"})})}const _n=L.object({newPassword:z("newPassword"),confirmPassword:z("confirmPassword")}).refine(s=>s.newPassword===s.confirmPassword,{message:"Passwords do not match",path:["confirmPassword"]});function Yn(){const[s]=he(),{resetPassword:n}=U(),t=V(),o=s.get("email")||"",r=s.get("resetCode")||"";if(!o||!r)return e.jsx(i,{children:"Invalid reset link"});const a=async d=>{try{await n.mutateAsync({email:o,resetCode:r,newPassword:d.newPassword},{onSuccess:()=>{q.success("Password changed successfully"),t("/login")}})}catch(u){console.log(u)}};return e.jsxs(we,{title:"Reset Password",icon:e.jsx(je,{fontSize:"large"}),resolver:Y(_n),onSubmit:a,submitButtonText:"Update Password",reset:!0,children:[e.jsx(R,{name:"newPassword",label:"New Password",type:"password"}),e.jsx(R,{name:"confirmPassword",label:"Confirm Password",type:"password"})]})}function Jn(){const[s]=he(),{fetchGithubToken:n}=U(),t=s.get("code"),[o,r]=g.useState(!0),a=g.useRef(!1),d=V();return g.useEffect(()=>{!t||a.current||(a.current=!0,n.mutateAsync(t).then(()=>{d("/activities")}).catch(u=>{console.log(u),r(!1)}))},[t,n,d]),t?e.jsxs(k,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:400,p:3,gap:3,maxWidth:"md",mx:"auto",borderRadius:3},children:[e.jsxs(l,{display:"flex",alignItems:"center",gap:3,justifyContent:"center",children:[e.jsx(ze,{fontSize:"large"}),e.jsx(i,{variant:"h4",children:" Logging in with Github "})]}),o?e.jsx(me,{}):e.jsx(i,{children:"Problem sigining in with Github"})]}):e.jsx(i,{children:" Problem connecting with Github "})}const ue=Ke([{path:"/",element:e.jsx(rn,{}),children:[{element:e.jsx(kn,{}),children:[{path:"activities",element:e.jsx(un,{})},{path:"activities/:id",element:e.jsx(vn,{})},{path:"createActivity",element:e.jsx(Pe,{},"create")},{path:"manage/:id",element:e.jsx(Pe,{})},{path:"profiles/:id",element:e.jsx(On,{})},{path:"change-password",element:e.jsx(Vn,{})}]},{path:"",element:e.jsx(Te,{})},{path:"counter",element:e.jsx(Sn,{})},{path:"errors",element:e.jsx(Pn,{})},{path:"/not-found",element:e.jsx(In,{})},{path:"/server-error",element:e.jsx(An,{})},{path:"/login",element:e.jsx(Dn,{})},{path:"/register",element:e.jsx(Rn,{})},{path:"/confirm-email",element:e.jsx(Qn,{})},{path:"/forgot-password",element:e.jsx(Kn,{})},{path:"/reset-password",element:e.jsx(Yn,{})},{path:"/auth-callback",element:e.jsx(Jn,{})},{path:"*",element:e.jsx(De,{replace:!0,to:"/not-found"})}]}]),Zn=new Oe;qe.createRoot(document.getElementById("root")).render(e.jsx(g.StrictMode,{children:e.jsx(Ns,{dateAdapter:Us,children:e.jsx(Ue.Provider,{value:W,children:e.jsxs(Qe,{client:Zn,children:[e.jsx(Ge,{}),e.jsx(He,{position:"bottom-right",autoClose:3e3,hideProgressBar:!0,theme:"colored"}),e.jsx(_e,{router:ue})]})})})}));
